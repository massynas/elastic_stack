<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours Complet - La Suite Elastic (ELK) v8.x</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 
    Structure du Cours (Bas√©e sur les recommandations)
    0. Pr√©requis (VM Standardis√©e)
    1. Introduction (Contexte M√©tier)
    1.5. Th√©orie des Logs
    2. Architecture
    3. ES Fondamentaux (Th√©orie)
    4. Installation (Pratique - Apache, ES, Kibana)
    5. Logstash (Th√©orie + Pratique)
    6. Beats (Th√©orie + Pratique)
    7. Kibana (Th√©orie + Pratique)
    8. Cas Pratiques (Projet)
    9. Optimisation
    10. Quiz
    Annexe: D√©pannage VM
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        .code-block {
            position: relative;
            background-color: #1f2937; /* gray-800 */
            color: #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            overflow-x: auto;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
        }
        .code-block .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #374151; /* gray-700 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem; /* rounded */
            font-size: 0.75rem; /* text-xs */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .code-block .copy-btn:hover {
            background-color: #4b5563; /* gray-600 */
        }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; /* slate-100 */ }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; /* slate-300 */ border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; /* slate-400 */ }

        .sidebar-link.active {
            background-color: #e0f2fe; /* sky-100 */
            color: #0c4a6e; /* sky-800 */
            font-weight: 600;
        }
        .sidebar-title {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* semibold */
            color: #64748b; /* slate-500 */
            text-transform: uppercase;
            letter-spacing: 0.05em; /* tracking-wider */
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            margin-top: 1rem; /* mt-4 */
        }
        
        /* Styles pour les diagrammes */
        .diagram-box {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background-color: #f8fafc; /* slate-50 */
            border: 1px solid #e2e8f0; /* slate-200 */
            display: flex; flex-direction: column; align-items: center;
            min-width: 90px;
            transition: all 0.2s;
        }
        .diagram-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-color: #0ea5e9; /* sky-500 */
        }
        .diagram-arrow { 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem; /* text-4xl */
            color: #94a3b8; /* slate-400 */
            transform: rotate(90deg); /* Fl√®che vers le bas par d√©faut pour mobile */
        }
        @media (min-width: 768px) { 
            .diagram-arrow { 
                transform: rotate(0deg); /* Fl√®che vers la droite sur desktop */
                min-width: 50px;
            } 
        }

        /* Styles pour les Tiers ILM */
        .ilm-tier {
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border-width: 2px;
        }
        .ilm-hot { border-color: #ef4444; background-color: #fee2e2; }
        .ilm-warm { border-color: #f97316; background-color: #ffedd5; }
        .ilm-cold { border-color: #3b82f6; background-color: #dbeafe; }
        .ilm-frozen { border-color: #64748b; background-color: #f1f5f9; }
        
        /* Styles pour Sharding Diagram */
        .node-box {
            background-color: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem;
        }
        .shard-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border-radius: 0.25rem;
            font-weight: 600;
            margin: 0.25rem;
        }
        .shard-p { background-color: #dbeafe; border: 1px solid #93c5fd; color: #1e40af; } /* Primary */
        .shard-r { background-color: #e5e7eb; border: 1px solid #9ca3af; color: #374151; } /* Replica */
        
        .focus-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-left-width: 4px;
            border-left-color: #0ea5e9; /* sky-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
        }
    </style>
</head>
<body class="bg-slate-50">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <!-- La sidebar est fixe sur grand √©cran, et masqu√©e/affich√©e via JS sur mobile -->
        <aside class="w-full md:w-72 bg-white border-r border-slate-200 h-screen overflow-y-auto fixed top-0 left-0 z-10 -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out" id="sidebar">
            <div class="p-6">
                <h2 class="text-xl font-bold text-sky-900">Cours Elastic v8.x</h2>
                <p class="text-sm text-slate-500">Structure Am√©lior√©e</p>
            </div>
            <nav class="mt-4 px-3">
                <ul class="space-y-1">
                    <!-- AJOUT : Chapitre 0 -->
                    <li class="sidebar-title">Pr√©requis</li>
                    <li><a href="#setup-vm" class="sidebar-link active group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">0. Pr√©requis : Environnement VM</a></li>

                    <li class="sidebar-title">Introduction</li>
                    <li><a href="#intro" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">1. Introduction √† ELK</a></li>
                    <li><a href="#theorie-logs" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">1.5. Th√©orie des Logs (Le "Pourquoi")</a></li>
                    <li><a href="#architecture" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">2. Architecture Globale</a></li>

                    <li class="sidebar-title">Elasticsearch</li>
                    <li><a href="#es-fondamentaux" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">3. ES - Fondamentaux</a></li>
                    <li><a href="#installation" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">4. ES - Installation & Admin</a></li>

                    <li class="sidebar-title">Ingestion</li>
                    <li><a href="#logstash" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">5. Logstash</a></li>
                    <li><a href="#beats" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">6. La Famille Beats</a></li>

                    <li class="sidebar-title">Visualisation</li>
                    <li><a href="#kibana" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">7. Kibana</a></li>
                    
                    <li class="sidebar-title">Ma√Ætrise</li>
                    <li><a href="#cas-pratiques" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">8. Cas Pratiques</a></li>
                    <li><a href="#optimisation" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">9. Optimisation</a></li>
                    
                    <li class="sidebar-title">√âvaluation</li>
                    <li><a href="#quiz" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">10. Quiz Final</a></li>

                    <!-- AJOUT : Annexe -->
                    <li class="sidebar-title">Annexe</li>
                    <li><a href="#annexe-vm" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">Annexe : D√©pannage VM</a></li>
                </ul>
            </nav>
            <div class="p-6 h-20"></div> <!-- Espace pour le scroll -->
        </aside>

        <!-- Main content -->
        <!-- Ajout de padding-top pour le menu burger mobile, et ml-72 pour le d√©calage de la sidebar sur desktop -->
        <main class="flex-1 overflow-y-auto pt-16 md:pt-0 md:ml-72">
            
            <!-- Bouton Menu Burger pour mobile -->
            <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-20 p-2 bg-white rounded-md shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            
            <!-- Overlay pour fermer le menu sur mobile -->
            <div id="menu-overlay" class="md:hidden fixed inset-0 bg-black/50 z-0 opacity-0 transition-opacity duration-300 hidden"></div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                
                <!-- AJOUT : Chapitre 0 - Pr√©requis VM -->
                <section id="setup-vm" class="content-section space-y-6">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">0. Pr√©requis et Configuration de l'Environnement</h1>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.1. Pourquoi une Machine Virtuelle ?</h3>
                    <p class="text-slate-700"><strong>Probl√®me :</strong> Chaque √©tudiant a un environnement diff√©rent (Windows 10/11, macOS, Ubuntu, Fedora...). Les instructions d'installation varient, les versions de Java diff√®rent, les permissions sont diff√©rentes.</p>
                    <p class="text-slate-700 mt-2"><strong>Solution :</strong> Nous allons tous utiliser <strong>exactement la m√™me machine virtuelle Linux</strong> pour garantir que :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li>Toutes les commandes fonctionnent √† l'identique.</li>
                        <li>Les versions des logiciels sont les m√™mes.</li>
                        <li>Les probl√®mes sont reproductibles et r√©solvables.</li>
                        <li>Le formateur peut aider efficacement.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.2. Configuration Requise de la Machine H√¥te</h3>
                    <p class="text-slate-700">Avant de commencer, votre ordinateur doit avoir :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>RAM :</strong> 8 Go minimum (16 Go recommand√©)</li>
                        <li><strong>Processeur :</strong> Support de la virtualisation (Intel VT-x ou AMD-V)</li>
                        <li><strong>Disque :</strong> 50 Go d'espace libre</li>
                        <li><strong>OS H√¥te :</strong> Windows 10+, macOS 10.14+, ou Linux moderne</li>
                    </ul>
                    <p class="text-slate-700 mt-2"><strong>V√©rification de la virtualisation (Windows) :</strong> Ouvrez le Gestionnaire des t√¢ches (Ctrl+Shift+√âchap) -> Onglet "Performance" -> "Processeur". V√©rifiez que "Virtualisation" est "Activ√©e".</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.3. Installation de VirtualBox</h3>
                    <p class="text-slate-700">T√©l√©chargez et installez VirtualBox depuis <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" class="text-sky-600 underline">virtualbox.org</a>. Suivez l'assistant d'installation par d√©faut. Red√©marrez si demand√© (surtout sur Windows).</p>
                    <p class="text-slate-700 mt-2">Sur macOS, n'oubliez pas d'autoriser l'extension dans "Pr√©f√©rences Syst√®me -> S√©curit√© et confidentialit√©".</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.4. T√©l√©chargement des Outils Officiels</h3>
                    <p class="text-slate-700">Nous n'utiliserons pas d'image pr√©-faite. Nous allons tout construire √† partir des sources officielles :</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li><strong>VirtualBox :</strong> Si ce n'est pas d√©j√† fait, t√©l√©chargez-le depuis <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" class="text-sky-600 underline">virtualbox.org</a>.</li>
                        <li><strong>Ubuntu Server :</strong> T√©l√©chargez l'ISO de <strong>Ubuntu Server 22.04 LTS</strong> (pas Desktop) depuis <a href="https://ubuntu.com/download/server" target="_blank" class="text-sky-600 underline">ubuntu.com</a>.</li>
                    </ol>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5. Cr√©ation de la Machine Virtuelle</h3>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li>Ouvrez VirtualBox et cliquez sur "Nouvelle" (ic√¥ne bleue).</li>
                        <li><strong>Nom :</strong> `ElasticStack-VM`</li>
                        <li><strong>Image ISO :</strong> S√©lectionnez le fichier `.iso` d'Ubuntu Server 22.04 que vous venez de t√©l√©charger.</li>
                        <li>Cochez "Installer en mode 'unattended'" (Installation non assist√©e).</li>
                        <li><strong>Utilisateur :</strong> `elastic-student`</li>
                        <li><strong>Mot de passe :</strong> `Formation2025!`</li>
                        <li><strong>Nom d'h√¥te :</strong> `ubuntu-elastic`</li>
                        <li><strong>Configuration Mat√©rielle :</strong> Allouez au moins **4 Go (4096 Mo) de RAM** et **2 c≈ìurs de CPU**.</li>
                        <li><strong>Disque Dur :</strong> Cr√©ez un disque virtuel de **40 Go** (taille dynamique).</li>
                        <li>Suivez l'assistant. VirtualBox va d√©marrer la VM et installer Ubuntu automatiquement. Cela peut prendre 10-15 minutes.</li>
                    </ol>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.6. Configuration R√©seau de la VM</h3>
                    <p class="text-slate-700">Pour que votre PC (H√¥te) puisse parler √† votre VM (Invit√©), nous devons configurer le r√©seau.</p>
                    <div class="focus-box">
                        <h4 class="text-lg font-semibold text-slate-800">Option A : Acc√®s par Pont (Recommand√©)</h4>
                        <ol class="list-decimal list-inside space-y-2 text-slate-700 text-sm">
                            <li>S√©lectionnez votre VM dans VirtualBox (√©teinte).</li>
                            <li>Cliquez sur "Configuration" -> Onglet "R√©seau".</li>
                            <li>"Mode d'acc√®s r√©seau" : <strong>Acc√®s par pont (Bridged Adapter)</strong>.</li>
                            <li>"Nom" : S√©lectionnez votre carte r√©seau principale (ex: Wi-Fi ou Ethernet).</li>
                        </ol>
                        <p class="text-slate-700 text-sm mt-2">Votre VM obtiendra sa propre IP sur votre r√©seau local (ex: 192.168.1.150).</p>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.7. Premier D√©marrage et Configuration</h3>
                    <p class="text-slate-700">Une fois l'installation d'Ubuntu termin√©e, connectez-vous avec `elastic-student` et `Formation2025!`.</p>
                    <p class="text-slate-700 mt-2">Ouvrez un terminal et mettez √† jour le syst√®me :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt update && sudo apt upgrade -y
</code></pre>
                    </div>

                    <!-- AJOUT : Installation de Java -->
                    <p class="text-slate-700 mt-4 font-semibold">Installation de Java (Pr√©-requis Elastic)</p>
                    <p class="text-slate-700">Elasticsearch 8.x requiert Java 11 ou 17. Nous allons installer Java 11 :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt install openjdk-11-jdk -y
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">V√©rifiez l'installation :</p>
                    <div class="code-block">
<pre><code class="language-bash">java -version
# Doit afficher : openjdk version "11.0.x"
</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.8. Configuration SSH (Acc√®s Confort)</h3>
                    <p class="text-slate-700">Pour copier-coller facilement les commandes, nous allons nous connecter √† la VM via SSH depuis notre machine h√¥te.</p>
                    <div class="code-block">
<pre><code class="language-bash"># Dans la VM, installez le serveur SSH
sudo apt install openssh-server -y
sudo systemctl start ssh
sudo systemctl enable ssh

# Obtenez l'IP de votre VM
ip addr show
# Notez l'adresse IP (ex: 192.168.1.150)
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">Depuis votre machine **h√¥te** (PowerShell, Terminal, etc.) :</p>
                    <div class="code-block">
<pre><code class="language-bash">ssh elastic-student@[IP_DE_LA_VM]
# Entrez le mot de passe : Formation2025!
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">Vous √™tes maintenant connect√© √† votre VM. <strong>Ex√©cutez la suite du cours depuis ce terminal SSH.</strong></p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.9. Snapshot de Sauvegarde (Crucial)</h3>
                    <div class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg">
                        <p class="font-semibold">TR√àS IMPORTANT : Avant de commencer le Chapitre 1, cr√©ez un snapshot.</p>
                        <ol class="list-decimal list-inside space-y-1 text-sm mt-2">
                            <li>√âteignez votre VM.</li>
                            <li>Dans VirtualBox, s√©lectionnez votre VM.</li>
                            <li>Menu "Machine" -> "Prendre un instantan√©" (ou ic√¥ne "Snapshots").</li>
                            <li>Nom : "VM Propre - Avant Cours"</li>
                        </ol>
                        <p class="text-sm mt-2">Si vous cassez quelque chose, vous pourrez revenir √† cet √©tat propre en 30 secondes.</p>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.10. Validation de l'Environnement</h3>
                    <div class="focus-box border-l-green-500">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Avant de Commencer</h3>
                        <p class="text-slate-700 mb-4">Ex√©cutez ces commandes manuelles pour valider que votre environnement est pr√™t :</p>
                        <div class="code-block">
<pre><code class="language-bash"># 1. V√©rifie Java
java -version

# 2. V√©rifie la RAM (colonne "total" de la ligne Mem:)
free -h

# 3. V√©rifie le disque (ligne "/")
df -h /

# 4. V√©rifie l'acc√®s internet
ping -c 1 google.com
</code></pre>
                        </div>
                        <p class="text-slate-700 mt-4">Si tout est OK (Java 11, RAM > 3.5Go, Disque > 30Go, ping r√©ussi), vous √™tes pr√™t pour le Chapitre 1 !</p>
                    </div>

                </section>

                <!-- 1. Introduction -->
                <section id="intro" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">1. Introduction √† la Suite Elastic (ELK)</h1>
                    <p class="text-lg text-slate-600">Bienvenue dans ce cours sur la stack Elastic 8.x ! Nous allons transformer des donn√©es brutes en informations pr√©cieuses. Ce guide interactif vous accompagnera de la th√©orie fondamentale √† la cr√©ation de dashboards complexes.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900">Les 3 Composants Historiques (ELK)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">üóÑÔ∏è</span>
                            <h4 class="text-xl font-semibold text-blue-800 mt-2">Elasticsearch</h4>
                            <p class="text-slate-600 mt-2">Le **c≈ìur** de la stack. Un moteur de recherche et d'analyse distribu√©. Il stocke, indexe et rend les donn√©es consultables √† une vitesse fulgurante.</p>
                        </div>
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">‚öôÔ∏è</span>
                            <h4 class="text-xl font-semibold text-orange-800 mt-2">Logstash</h4>
                            <p class="text-slate-600 mt-2">Le **pipeline** de traitement. Un outil c√¥t√© serveur qui ing√®re les donn√©es de multiples sources, les transforme (parse, enrichit) et les envoie vers Elasticsearch.</p>
                        </div>
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">üìä</span>
                            <h4 class="text-xl font-semibold text-green-800 mt-2">Kibana</h4>
                            <p class="text-slate-600 mt-2">L'**interface** de visualisation. L'outil web qui vous permet d'explorer, de visualiser (graphiques, cartes) et de cr√©er des dashboards avec vos donn√©es.</p>
                        </div>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">... Et l'√âvolution : Les Beats</h3>
                    <p class="text-slate-600">Depuis, la famille s'est agrandie avec les **Beats** : des agents l√©gers con√ßus pour collecter des types de donn√©es sp√©cifiques (logs, m√©triques, etc.) directement depuis vos serveurs.</p>

                    <!-- AJOUT : Histoire et √âvolution -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Histoire et √âvolution</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>2010 :</strong> Shay Banon cr√©e Elasticsearch (initialement pour un projet de recettes de cuisine pour sa femme).</li>
                        <li><strong>2012 :</strong> Jordan Sissel cr√©e Logstash pour centraliser les logs.</li>
                        <li><strong>2013 :</strong> Rashid Khan cr√©e Kibana pour visualiser les donn√©es.</li>
                        <li><strong>2014 :</strong> Elastic (l'entreprise) est fond√©e, unissant ces trois projets.</li>
                        <li><strong>2015 :</strong> Introduction des Beats, des agents de collecte l√©gers.</li>
                        <li><strong>2021 :</strong> Changement de licence (Elastic License v2 & SSPL) pour se prot√©ger de l'utilisation par les fournisseurs cloud.</li>
                    </ul>
                </section>
                
                <!-- 1.5. Th√©orie des Logs (Le 'Pourquoi') -->
                <section id="theorie-logs" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">1.5. Comprendre les Logs (Le "Pourquoi")</h1>
                    <p class="text-lg text-slate-600">Avant de plonger dans la technique, comprenons pourquoi les logs sont l'une des ressources les plus pr√©cieuses (et sous-estim√©es) d'une entreprise.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5.1. Qu'est-ce qu'un Log ?</h3>
                    <p class="text-slate-700"><strong>D√©finition simple :</strong> Un log est un "journal" automatique d'√©v√©nements qu'√©crit un programme ou un syst√®me. C'est comme un carnet de bord qui enregistre tout ce qui se passe.</p>
                    <p class="text-slate-700 mt-2"><strong>Analogie :</strong> Un serveur web √©crit dans son journal :</p>
                    <div class="code-block text-sm">
<pre><code>"2025-11-03 08:30:15 : Utilisateur 'jean' s'est connect√©"
"2025-11-03 09:15:32 : Page '/index.html' visit√©e depuis IP 192.168.1.100"
"2025-11-03 10:00:45 : ERREUR : Fichier 'config.php' introuvable"</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5.2. Pourquoi les Logs sont-ils Cruciaux ?</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-blue-700">1. D√©bogage (Debug)</h4>
                            <p class="text-slate-600 text-sm mt-1">Quand un site plante, le log dit pourquoi.</p>
                            <code class="text-xs text-red-600 block mt-1">[ERROR] Database connection failed: Timeout</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-red-700">2. S√©curit√© (SIEM)</h4>
                            <p class="text-slate-600 text-sm mt-1">D√©tecter les attaques en temps r√©el.</p>
                            <code class="text-xs text-red-600 block mt-1">[WARN] Failed login 'admin' from IP 1.2.3.4 (3 attempts)</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-green-700">3. Performance (APM)</h4>
                            <p class="text-slate-600 text-sm mt-1">R√©v√©ler les goulots d'√©tranglement.</p>
                            <code class="text-xs text-orange-600 block mt-1">[INFO] Page '/produits' loaded in 5.2s (DB: 4.8s)</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-purple-700">4. Business Intelligence</h4>
                            <p class="text-slate-600 text-sm mt-1">Donner des insights m√©tier.</p>
                            <code class="text-xs text-purple-600 block mt-1">[INFO] "GET /produit/iphone-15" 200</code>
                        </div>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5.3. Le Probl√®me : L'Explosion des Logs</h3>
                    <p class="text-slate-700">Un site e-commerce moyen g√©n√®re des dizaines de milliers de lignes par jour. Sans outil, il est impossible de r√©pondre √† des questions simples :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li>"Pourquoi le site √©tait lent hier √† 15h ?"</li>
                        <li>"Quelle IP a g√©n√©r√© le plus d'erreurs 404 cette semaine ?"</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5.4. La Solution : Centralisation et Analyse</h3>
                    <p class="text-slate-700">C'est exactement le r√¥le de la **Stack Elastic** :</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li><strong>Collecter</strong> tous les logs dispers√©s (Beats/Logstash).</li>
                        <li><strong>Centraliser</strong> dans un moteur de recherche (Elasticsearch).</li>
                        <li><strong>Visualiser</strong> avec des graphiques (Kibana).</li>
                    </ol>
                    <p class="text-slate-700 mt-2">Au lieu de chercher dans 50 fichiers, vous tapez dans Kibana :</p>
                    <div class="code-block">
<pre><code>response:404 AND @timestamp:[now-1h TO now]</code></pre>
                    </div>
                </section>

                <!-- 2. Architecture Globale -->
                <section id="architecture" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">2. Architecture Globale</h1>
                    <p class="text-lg text-slate-600">Comprendre comment les donn√©es circulent est essentiel. Voici les architectures les plus courantes.</p>
                    
                    <div class="p-6 bg-white rounded-xl shadow-lg mt-4">
                        <h4 class="font-semibold text-lg text-slate-800">1. Architecture "Simple" : Beats ‚Üí Elasticsearch</h4>
                        <p class="text-sm text-slate-600 mb-4">Id√©al pour les logs standards (via Modules) et les m√©triques. Faible latence.</p>
                        <div class="flex flex-col md:flex-row items-center justify-around">
                            <div class="diagram-box" title="Serveurs Sources"><span class="text-2xl">üìà</span> <span class="text-xs font-medium">Beats</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Stockage"><span class="text-2xl">üóÑÔ∏è</span> <span class="text-xs font-medium">Elasticsearch</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Visualisation"><span class="text-2xl">üìä</span> <span class="text-xs font-medium">Kibana</span></div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-white rounded-xl shadow-lg mt-4">
                        <h4 class="font-semibold text-lg text-slate-800">2. Architecture "Flexible" : Beats ‚Üí Logstash ‚Üí Elasticsearch</h4>
                        <p class="text-sm text-slate-600 mb-4">L'architecture la plus courante. N√©cessaire si vous avez des logs "custom", si vous devez masquer des donn√©es (ex: RGPD) ou enrichir les donn√©es (ex: GeoIP).</p>
                        <div class="flex flex-col md:flex-row items-center justify-around">
                            <div class="diagram-box" title="Serveurs Sources"><span class="text-2xl">üìà</span> <span class="text-xs font-medium">Beats</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Transformation"><span class="text-2xl">‚öôÔ∏è</span> <span class="text-xs font-medium">Logstash</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Stockage"><span class="text-2xl">üóÑÔ∏è</span> <span class="text-xs font-medium">Elasticsearch</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Visualisation"><span class="text-2xl">üìä</span> <span class="text-xs font-medium">Kibana</span></div>
                        </div>
                    </div>

                    <!-- AJOUT : Focus Th√©orique -->
                    <div class="focus-box mt-6">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Focus Th√©orique : Quand se passer de Logstash ?</h3>
                        <p class="text-slate-700">Vous pouvez envoyer les Beats directement √† Elasticsearch (Architecture 1) si :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                            <li>Vous utilisez un **Module Beats** (ex: Nginx, MySQL) qui g√®re le parsing via un "Pipeline d'Ingestion" c√¥t√© Elasticsearch.</li>
                            <li>Vos logs sont d√©j√† en format JSON propre.</li>
                            <li>Vous n'avez pas besoin d'enrichissement complexe (ex: appels √† une API externe).</li>
                        </ul>
                    </div>

                </section>
                
                <!-- 3. ES - Fondamentaux -->
                <section id="es-fondamentaux" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">3. Elasticsearch - Fondamentaux</h1>
                    <p class="text-lg text-slate-600">Plongeons dans le c≈ìur du r√©acteur. Elasticsearch n'est PAS une base de donn√©es SQL. Voici pourquoi.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Terminologie : SQL vs Elasticsearch</h3>
                    <p class="text-slate-700 mb-4">L'analogie la plus simple pour comprendre la structure :</p>
                    <table class="w-full border border-slate-300 text-left">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-3 border-r">Monde SQL (Relationnel)</th>
                                <th class="p-3">Monde Elasticsearch (Document)</th>
                                <th class="p-3">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Base de Donn√©es</td><td class="p-3 font-semibold">Cluster</td><td class="p-3">Un ensemble de serveurs.</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Table</td><td class="p-3 font-semibold">Index</td><td class="p-3">Une collection de donn√©es similaires (ex: `logs-apache`).</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Ligne</td><td class="p-3 font-semibold">Document</td><td class="p-3">Une seule entr√©e de donn√©e (un log, un produit).</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Colonne</td><td class="p-3 font-semibold">Champ (Field)</td><td class="p-3">Une cl√© et sa valeur (ex: `"response": 200`).</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Sch√©ma</td><td class="p-3 font-semibold">Mapping</td><td class="p-3">La d√©finition des types de champs (ex: `response` est un `integer`).</td></tr>
                        </tbody>
                    </table>

                    <div class="p-6 bg-white rounded-xl shadow-lg mt-6">
                        <h3 class="text-2xl font-semibold text-sky-900 mb-4">Le Secret de la Vitesse : L'Index Invers√©</h3>
                        <p class="text-slate-700 mb-4">Comment ES peut-il trouver un mot dans 1 milliard de documents en millisecondes ? Il n'lit pas les documents, il utilise un index invers√© (comme l'index √† la fin d'un livre).</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-slate-800">Documents :</h4>
                                <p class="font-mono bg-sky-100 px-2 py-1 rounded">Doc 1: "Le renard brun."</p>
                                <p class="font-mono bg-green-100 px-2 py-1 rounded mt-2">Doc 2: "Le renard saute."</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-slate-800">Index Invers√© (Simplifi√©) :</h4>
                                <table class="w-full border border-slate-300 text-left text-sm mt-2">
                                    <thead class="bg-slate-100"><tr><th class="p-2">Terme</th><th class="p-2">Documents</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td class="p-2">"brun"</td><td class="p-2"><span class="bg-sky-100 px-2 py-1 rounded">Doc 1</span></td></tr>
                                        <tr class="border-b"><td class="p-2">"le"</td><td class="p-2"><span class="bg-sky-100 px-2 py-1 rounded">Doc 1</span>, <span class="bg-green-100 px-2 py-1 rounded">Doc 2</span></td></tr>
                                        <tr class="border-b"><td class="p-2">"renard"</td><td class="p-2"><span class="bg-sky-100 px-2 py-1 rounded">Doc 1</span>, <span class="bg-green-100 px-2 py-1 rounded">Doc 2</span></td></tr>
                                        <tr class="border-b"><td class="p-2">"saute"</td><td class="p-2"><span class="bg-green-100 px-2 py-1 rounded">Doc 2</span></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <p class="text-slate-700 mt-4">Une recherche pour "renard" ne lit pas les documents. Elle consulte l'index, trouve `Doc 1` et `Doc 2` instantan√©ment, puis r√©cup√®re ces documents.</p>
                    </div>

                    <div class="focus-box mt-6">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Concept Cl√© : Analyse (`text` vs `keyword`)</h3>
                        <p class="text-slate-700">C'est le concept le plus important du "Mapping" (sch√©ma) :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                            <li><strong>`text` (Texte complet) :</strong> Le champ est **analys√©**. "Le renard brun" est d√©coup√© en tokens: `["le", "renard", "brun"]`. Cela permet de rechercher "renard". Utilis√© pour les descriptions, le corps des emails, le message des logs.</li>
                            <li><strong>`keyword` (Mot-cl√©) :</strong> Le champ **n'est pas analys√©**. "Le renard brun" est stock√© comme une seule valeur. On ne peut pas rechercher "renard". On doit chercher la valeur *exacte*. Utilis√© pour les codes HTTP (`response: 200`), les IPs, les noms d'utilisateurs, les statuts.</li>
                        </ul>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Scalabilit√© : Shards & Replicas</h3>
                    <p class="text-slate-700 mb-4">Comment ES g√®re-t-il des P√©taoctets de donn√©es ? Il divise le travail.</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                        <li><strong>Shards (Fragments) :</strong> ES divise votre index en morceaux (shards). Si vous avez un index de 1To avec 10 shards, chaque shard g√®re environ 100Go. Cela permet le **scaling horizontal** (ajouter des machines pour r√©partir les shards).</li>
                        <li><strong>Replicas (R√©pliques) :</strong> ES cr√©e des copies de vos shards. Une r√©plique n'est jamais sur la m√™me machine que son shard principal. Si un n≈ìud (machine) tombe en panne, la r√©plique prend le relais. Cela garantit la **haute disponibilit√©**.</li>
                    </ul>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Exemple: Cluster √† 3 N≈ìuds</h4>
                    <p class="text-slate-700 mb-2">Imaginons un index `logs` avec 3 shards (P0, P1, P2) et 1 r√©plique (R0, R1, R2).</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="node-box">
                            <h5 class="font-bold">N≈ìud 1</h5>
                            <div class="shard-box shard-p">P0</div>
                            <div class="shard-box shard-r">R1</div>
                        </div>
                        <div class="node-box">
                            <h5 class="font-bold">N≈ìud 2</h5>
                            <div class="shard-box shard-p">P1</div>
                            <div class="shard-box shard-r">R2</div>
                        </div>
                        <div class="node-box">
                            <h5 class="font-bold">N≈ìud 3</h5>
                            <div class="shard-box shard-p">P2</div>
                            <div class="shard-box shard-r">R0</div>
                        </div>
                    </div>
                    <p class="text-slate-600 mt-4 text-sm">Si le **N≈ìud 2 tombe en panne**, P1 est perdu. Mais pas de panique : R1 (sur le N≈ìud 1) est automatiquement promu en shard principal. L'index est toujours 100% fonctionnel.</p>
                
                    <!-- AJOUT : Pratique Dev Tools -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Pratique : L'API via les "Dev Tools"</h3>
                    <p class="text-slate-700 mb-4">La seule fa√ßon de parler √† Elasticsearch est via son API REST (en JSON). Kibana fournit un outil "Dev Tools" pour le faire facilement.</p>
                    <p class="text-slate-700">Voici les commandes de base (√† tester dans Kibana > Dev Tools) :</p>
                    <div class="code-block">
<pre><code class="language-json"># 1. Cr√©er (ou mettre √† jour) un document
POST /mon-premier-index/_doc/1
{
  "user": "alex",
  "message": "Ceci est mon premier document!"
}

# 2. R√©cup√©rer ce document
GET /mon-premier-index/_doc/1

# 3. Rechercher dans l'index (via Query DSL)
GET /mon-premier-index/_search
{
  "query": {
    "match": {
      "message": "document"
    }
  }
}

# 4. Supprimer un document
DELETE /mon-premier-index/_doc/1

# 5. Supprimer un index (ATTENTION: irr√©versible)
DELETE /mon-premier-index
</code></pre>
                    </div>
                </section>
                
                <!-- 4. ES - Installation & Admin -->
                <section id="installation" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">4. Installation & Administration</h1>
                    <p class="text-lg text-slate-600">Mettons en place notre environnement de travail (sur Debian/Ubuntu).</p>

                    <!-- AJOUT : Installation Apache en premier -->
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-8">4.0. Pr√©requis : Installation d'Apache</h2>
                    <p class="text-slate-700 mb-4"><strong>Pourquoi ?</strong> Apache est le serveur web qui va g√©n√©rer les logs que nous analyserons. Nous l'installons maintenant pour avoir des donn√©es √† disposition.</p>
                    <div class="code-block">
<pre><code class="language-bash"># Installation
sudo apt update
sudo apt install apache2 -y

# D√©marrage et activation au boot
sudo systemctl start apache2
sudo systemctl enable apache2

# V√©rification (doit √™tre "active (running)")
sudo systemctl status apache2
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-4"><strong>Test de fonctionnement :</strong></p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <!-- MODIFI√â : Utilisation de l'IP de la VM -->
                        <li>Ouvrez `http://[IP_DE_LA_VM]` dans le navigateur de votre machine **h√¥te** (vous devriez voir la page par d√©faut d'Apache).</li>
                        <li>G√©n√©rez des logs en simulant du trafic (une erreur 404 est un bon test) :</li>
                    </ol>
                    <div class="code-block mt-2">
<pre><code class="language-bash"># Ex√©cutez ceci dans votre terminal SSH (connect√© √† la VM)
curl http://localhost/
curl http://localhost/page-qui-nexiste-pas  # G√©n√®re un 404
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-4"><strong>Format du log (dans `/var/log/apache2/access.log`) :</strong></p>
                    <div class="code-block text-sm">
<pre><code>127.0.0.1 - - [03/Nov/2025:14:30:15 +0000] "GET / HTTP/1.1" 200 3380 "-" "curl/7.68.0"</code></pre>
                    </div>

                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.1. Installation d'Elasticsearch (v8.x)</h2>
                    <p>Ajoutez la cl√© et le d√©p√¥t Elastic :</p>
                    <div class="code-block">
<pre><code class="language-bash"># 1. Ajouter la cl√© GPG d'Elastic
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg

# 2. Ajouter le d√©p√¥t
sudo apt-get install apt-transport-https
echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list

# 3. Installer Elasticsearch
sudo apt-get update && sudo apt-get install elasticsearch
</code></pre>
                    </div>
                    <p class="mt-4">Une fois install√©, d√©marrez-le. <strong>Important :</strong> La version 8.x active la s√©curit√© par d√©faut (HTTPS + mot de passe).</p>
                    
                    <!-- AJOUT : Configuration network.host -->
                    <p class="text-slate-700 font-semibold">Configuration pour la VM :</p>
                    <p class="text-slate-700">Pour qu'Elasticsearch soit accessible depuis votre machine h√¥te (via `[IP_DE_LA_VM]`), modifiez `/etc/elasticsearch/elasticsearch.yml` :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo nano /etc/elasticsearch/elasticsearch.yml
</code></pre>
                    </div>
                    <p class="text-slate-700">D√©commentez (ou ajoutez) la ligne `network.host` et mettez-la √† `0.0.0.0` :</p>
                    <div class="code-block"><pre><code>network.host: 0.0.0.0</code></pre></div>

                    <p class="text-slate-700 mt-4">D√©marrez le service et r√©initialisez le mot de passe :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo systemctl start elasticsearch
sudo systemctl enable elasticsearch

# Attendez 1-2 minutes que le service d√©marre...

# G√©n√©rez un nouveau mot de passe pour l'utilisateur 'elastic'
# (Le pr√©c√©dent est affich√© au premier d√©marrage, mais souvent perdu)
sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
</code></pre>
                    </div>
                    <p class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg mt-4"><strong>Important :</strong> Notez pr√©cieusement le mot de passe g√©n√©r√© !</p>
                    
                    <!-- AJOUT : V√©rifications ES -->
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">V√©rifications (Elasticsearch)</h4>
                    <div class="code-block">
<pre><code class="language-bash"># Test de base (remplacez <votre_mot_de_passe>)
# Note: Nous utilisons localhost ici car nous sommes DANS la VM
curl --insecure -u elastic:&lt;votre_mot_de_passe&gt; https://localhost:9200

# Devrait retourner un JSON avec "You Know, for Search"

# Erreur courante : vm.max_map_count
# Si le service ne d√©marre pas (voir sudo journalctl -u elasticsearch)
# Solution :
sudo sysctl -w vm.max_map_count=262144
echo 'vm.max_map_count=262144' | sudo tee -a /etc/sysctl.conf
</code></pre>
                    </div>

                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.2. Installation de Kibana (v8.x)</h2>
                    <p>Installez Kibana (qui se connectera √† notre ES local).</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt-get install kibana
</code></pre>
                    </div>
                    
                    <!-- AJOUT : Configuration server.host -->
                    <p class="text-slate-700 font-semibold mt-4">Configuration pour la VM :</p>
                    <p class="text-slate-700">Pour que Kibana soit accessible depuis votre navigateur h√¥te, modifiez `/etc/kibana/kibana.yml` :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo nano /etc/kibana/kibana.yml
</code></pre>
                    </div>
                    <p class="text-slate-700">D√©commentez (ou ajoutez) la ligne `server.host` et mettez-la √† `"0.0.0.0"` (avec les guillemets) :</p>
                    <div class="code-block"><pre><code>server.host: "0.0.0.0"</code></pre></div>
                    <p class="text-slate-700 mt-2">Assurez-vous aussi que l'URL d'Elasticsearch est correcte (elle devrait l'√™tre si vous utilisez le token) :</p>
                    <div class="code-block"><pre><code>elasticsearch.hosts: ["https://localhost:9200"]</code></pre></div>
                    
                    <p class="mt-4">Nous allons lier Kibana √† Elasticsearch en utilisant un "token d'enr√¥lement".</p>
                    <div class="code-block">
<pre><code class="language-bash"># Sur le serveur Elasticsearch, cr√©ez un token pour Kibana (expire en 30 min)
sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
</code></pre>
                    </div>
                    <p class="mt-4">Copiez le long token g√©n√©r√©. Ensuite, d√©marrez Kibana. Il vous demandera le token lors de la premi√®re visite sur `http://[IP_DE_LA_VM]:5601`.</p>
                    <p class="mt-2">Alternativement, si Kibana a d√©j√† d√©marr√©, modifiez `/etc/kibana/kibana.yml` pour ajouter l'URL d'Elasticsearch (en HTTPS) et red√©marrez-le.</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo systemctl start kibana
sudo systemctl enable kibana
</code></pre>
                    </div>
                    <!-- MODIFI√â : Utilisation de l'IP de la VM -->
                    <p class="mt-4">Acc√©dez √† `http://[IP_DE_LA_VM]:5601` depuis le navigateur de votre machine **h√¥te**. Connectez-vous avec l'utilisateur `elastic` et votre mot de passe.</p>

                    <!-- AJOUT : Checkpoint de fin de chapitre 4 -->
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.3. Checkpoint : Test de la Stack Compl√®te</h2>
                    <p class="text-lg text-slate-600">Avant de passer √† l'ingestion de donn√©es, v√©rifions que tout communique.</p>
                    <div class="focus-box border-l-green-500">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Objectif de Validation</h3>
                        <p class="text-slate-700 mb-4">Nous allons utiliser les **Dev Tools** de Kibana (notre interface de test) pour ins√©rer manuellement un document dans Elasticsearch. Si cela fonctionne, notre stack est pr√™te.</p>
                        <ol class="list-decimal list-inside space-y-2 text-slate-700">
                            <!-- MODIFI√â : Utilisation de l'IP de la VM -->
                            <li>Ouvrez Kibana (`http://[IP_DE_LA_VM]:5601`) dans votre navigateur **h√¥te**.</li>
                            <li>Cliquez sur le menu ‚ò∞ en haut √† gauche.</li>
                            <li>Descendez tout en bas, dans la section "Management", cliquez sur **"Dev Tools"**.</li>
                            <li>Dans la console de gauche, tapez cette commande et cliquez sur le bouton "Play" (triangle) :</li>
                        </ol>
                        <div class="code-block mt-4">
<pre><code class="language-json">POST /test-index/_doc/1
{
  "message": "Ma stack Elastic fonctionne !",
  "timestamp": "2025-11-03T14:00:00Z"
}
</code></pre>
                        </div>
                        <p class="text-slate-700 mt-4"><strong>R√©sultat attendu :</strong> Vous devriez voir un r√©sultat `"created": true` dans la fen√™tre de droite. Si c'est le cas, f√©licitations ! Elasticsearch et Kibana sont install√©s, s√©curis√©s et communiquent.</p>
                    </div>
                </section>
                
                <!-- 5. Logstash -->
                <section id="logstash" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">5. Logstash - Le Pipeline de Donn√©es</h1>
                    <p class="text-lg text-slate-600">Logstash est le "couteau suisse" de l'ingestion. Il re√ßoit, transforme et envoie les donn√©es.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.1. Th√©orie : Le Pipeline Logstash</h3>
                    <p class="text-slate-700 mb-4">Un pipeline Logstash a trois √©tapes :</p>
                    <div class="flex flex-col md:flex-row justify-between items-center text-center space-y-4 md:space-y-0">
                        <div class="p-4 bg-sky-50 rounded-lg w-full md:w-1/3">
                            <div class="text-5xl">üì•</div>
                            <h4 class="font-semibold text-sky-800 text-lg">1. Input</h4>
                            <p class="text-sm text-slate-600">La source des donn√©es (ex: `file`, `beats`, `tcp`).</p>
                        </div>
                        <div class="diagram-arrow">‚Üí</div>
                        <div class="p-4 bg-green-50 rounded-lg w-full md:w-1/3">
                            <div class="text-5xl">‚öôÔ∏è</div>
                            <h4 class="font-semibold text-green-800 text-lg">2. Filter</h4>
                            <p class="text-sm text-slate-600">Transformer les donn√©es (ex: `grok`, `mutate`, `date`).</p>
                        </div>
                        <div class="diagram-arrow">‚Üí</div>
                        <div class="p-4 bg-indigo-50 rounded-lg w-full md:w-1/3">
                            <div class="text-5xl">üì§</div>
                            <h4 class="font-semibold text-indigo-800 text-lg">3. Output</h4>
                            <p class="text-sm text-slate-600">La destination des donn√©es (ex: `elasticsearch`).</p>
                        </div>
                    </div>

                    <!-- AJOUT : Explication Grok -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.2. Th√©orie : Comprendre le Filtre "Grok"</h3>
                    <p class="text-slate-700 mb-4">Grok est le filtre le plus puissant. Il utilise des expressions r√©guli√®res (patterns) pour extraire des champs structur√©s √† partir d'un message de log non structur√©.</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 1 : Log simple</h4>
                    <p class="text-slate-700">Log : <code class="text-sm">"127.0.0.1 GET 200"</code></p>
                    <p class="text-slate-700">Pattern Grok : <code class="text-sm">"%{IP:client_ip} %{WORD:methode} %{NUMBER:code_http}"</code></p>
                    <p class="text-slate-700">R√©sultat (JSON) :</p>
                    <div class="code-block">
<pre><code class="language-json">{
  "client_ip": "127.0.0.1",
  "methode": "GET",
  "code_http": "200"
}
</code></pre>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 2 : Le pattern `%{COMBINEDAPACHELOG}`</h4>
                    <p class="text-slate-700">Notre log Apache est complexe : <code class="text-sm">127.0.0.1 - - [03/Nov/2025:14:30:15 +0000] "GET / HTTP/1.1" 200 3380...</code></p>
                    <p class="text-slate-700">Heureusement, Logstash fournit un pattern pr√©-d√©fini, `%{COMBINEDAPACHELOG}`, qui d√©compose automatiquement ce log en champs pertinents (`clientip`, `timestamp`, `verb`, `request`, `response`, `bytes`, etc.).</p>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 3 : D√©bogage Grok</h4>
                    <p class="text-slate-700">Si votre pattern ne fonctionne pas (vous obtenez un tag `_grokparsefailure`), utilisez le **Grok Debugger** dans Kibana (Dev Tools) pour tester en direct :</p>
                    <div class="code-block">
<pre><code class="language-json">POST _grok/debugger
{
  "pattern": "%{COMBINEDAPACHELOG}",
  "text": "127.0.0.1 - - [03/Nov/2025:14:30:15 +0000] \"GET / HTTP/1.1\" 200 3380 \"-\" \"curl/7.68.0\""
}
</code></pre>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.3. Pratique : Ingestion des Logs Apache</h3>
                    <p>Installez Logstash (`sudo apt-get install logstash`) et cr√©ez le fichier `/etc/logstash/conf.d/01-apache.conf` :</p>
                    <div class="code-block">
<pre><code class="language-conf"># 1. INPUT (Lire le fichier de log Apache)
input {
    file {
        path => "/var/log/apache2/access.log"
        start_position => "beginning"
        sincedb_path => "/dev/null" # Pour les tests, relire le fichier √† chaque fois
    }
}

# 2. FILTER (Parser le log)
filter {
    # Utiliser le pattern Grok pr√©-d√©fini
    grok {
        match => { "message" => "%{COMBINEDAPACHELOG}" }
    }
    # Utiliser la date du log, pas la date d'ingestion
    date {
        match => [ "timestamp" , "dd/MMM/yyyy:HH:mm:ss Z" ]
    }
    # Convertir les codes de r√©ponse en nombres
    mutate {
        convert => {
            "response" => "integer"
            "bytes" => "integer"
        }
    }
}

# 3. OUTPUT (Envoyer √† Elasticsearch v8.x s√©curis√©)
output {
    elasticsearch {
         # MODIFI√â : Utilisation de localhost (Logstash et ES sont sur la m√™me VM)
         # Bien que [IP_DE_LA_VM] fonctionnerait, localhost est plus direct.
         hosts => ["https://localhost:9200"] 
         index => "apache-logstash-%{+YYYY.MM.dd}"
         user => "elastic"
         password => "<VOTRE_MOT_DE_PASSE_ELASTIC>"
         ssl_verification_mode => "none" # Pour test local (certificat auto-sign√©)
    }
    # Afficher aussi en console pour d√©boguer
    stdout { 
         codec => rubydebug 
    }
}
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">D√©marrage et Test (Logstash)</h4>
                    <p class="text-slate-700">Avant de lancer le service, **toujours tester la configuration** :</p>
                    <div class="code-block">
<pre><code class="language-bash"># Test de syntaxe
sudo -u logstash /usr/share/logstash/bin/logstash --path.settings /etc/logstash -t -f /etc/logstash/conf.d/01-apache.conf
# Doit retourner "Configuration OK"
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-4">D√©marrez Logstash et donnez-lui la permission de lire les logs Apache :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo usermod -aG adm logstash
sudo systemctl restart logstash
sudo systemctl enable logstash
</code></pre>
                    </div>

                    <!-- AJOUT : Checkpoint Chapitre 5 -->
                    <div class="focus-box border-l-green-500 mt-6">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Chapitre 5</h3>
                        <!-- MODIFI√â : Utilisation de l'IP de la VM -->
                        <p class="text-slate-700 mb-4">Apr√®s avoir g√©n√©r√© du trafic Apache (`curl http://localhost/page-test` dans la VM), allez dans Kibana (`http://[IP_DE_LA_VM]:5601`) -> Discover (vous devrez cr√©er un Index Pattern `apache-logstash-*`) :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>Vous devriez voir vos nouveaux logs appara√Ætre.</li>
                            <li>Dans la liste des champs √† gauche, vous devriez voir `clientip`, `response`, `verb`, etc.</li>
                            <li><strong>Validation :</strong> Si vous ne voyez PAS un champ `tags` avec la valeur `_grokparsefailure`, votre parsing a r√©ussi !</li>
                        </ul>
                    </div>
                </section>
                
                <!-- 6. La Famille Beats -->
                <section id="beats" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">6. La Famille Beats</h1>
                    <p class="text-lg text-slate-600">Logstash est puissant mais lourd (il utilise Java). Pour la simple collecte, les Beats (√©crits en Go) sont plus l√©gers et pr√©f√©r√©s.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.1. Filebeat (Le collecteur de logs)</h3>
                    <p class="text-slate-700">**R√¥le :** L'agent de collecte de logs le plus populaire. Il remplace l'√©tape `input { file }` de Logstash. Il est l√©ger et s'installe sur tous vos serveurs.</p>
                    <p class="text-slate-700 mt-2">**Cas d'usage :** Collecter `/var/log/syslog` de 500 serveurs et les envoyer √† un Logstash central (ou directement √† ES).</p>
                    <p class="text-slate-700 mt-4"><strong>Concept Cl√© : Les Modules (ex: `filebeat modules enable apache`)</strong></p>
                    <p class="text-slate-700">Les modules sont des configurations pr√©-faites qui incluent :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li>La configuration de Filebeat (o√π trouver les logs).</li>
                        <li>Un pipeline d'ingestion (le parsing Grok, mais c√¥t√© Elasticsearch).</li>
                        <li>Des dashboards Kibana pr√©-construits.</li>
                    </ul>
                    <p class="text-slate-700 mt-2">C'est la m√©thode "facile" pour ing√©rer des logs standards (Nginx, MySQL, System...).</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.2. Metricbeat (Le collecteur de m√©triques)</h3>
                    <p class="text-slate-700">**R√¥le :** Collecte les m√©triques syst√®me et de services.</p>
                    <div class="focus-box">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Focus : M√©triques vs Logs</h3>
                        <ul class="space-y-3 mt-4">
                            <li class="flex items-start">
                                <span class="text-2xl mr-3">üßæ</span>
                                <div>
                                    <h4 class="font-semibold text-slate-800">Logs (Filebeat)</h4>
                                    <p class="text-slate-600 text-sm">Un enregistrement d'un **√©v√©nement discret**. (Ex: "Utilisateur 'admin' connect√©"). Vous les *filtrez*.</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl mr-3">üå°Ô∏è</span>
                                <div>
                                    <h4 class="font-semibold text-slate-800">M√©triques (Metricbeat)</h4>
                                    <p class="text-slate-600 text-sm">Une **mesure num√©rique** √† un instant T. (Ex: "CPU √† 35%"). Vous les *agr√©gez* (moyenne, max).</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <p class="text-slate-700 mt-4"><strong>Cas d'usage :** Collecter le CPU, la RAM, l'usage disque de tous vos serveurs, ainsi que les m√©triques de services (ex: nombre de connexions √† MySQL).</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.3. Packetbeat (Le sniffer r√©seau)</h3>
                    <p class="text-slate-700">**R√¥le :** Un "sniffer" r√©seau (comme Wireshark) qui analyse le trafic passivement pour reconstituer les protocoles (HTTP, DNS, SQL...).</p>
                    <p class="text-slate-700 mt-2">**Cas d'usage :** Mesurer les performances (ex: `GET /login` a pris `25ms`) et la s√©curit√© (ex: voir les requ√™tes `SELECT * FROM users` suspectes).</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.4. Les Autres Beats</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Heartbeat :</strong> Monitoring de disponibilit√© (Uptime). Il "ping" vos services (HTTP, TCP) pour v√©rifier qu'ils sont en ligne.</li>
                        <li><strong>Auditbeat :</strong> Audit de s√©curit√©. Surveille l'int√©grit√© des fichiers (ex: "Qui a modifi√© `/etc/passwd` ?") et les appels syst√®me.</li>
                        <li><strong>Winlogbeat :</strong> Collecte les journaux d'√©v√©nements Windows (Event Logs).</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.5. Comparaison : Logstash vs Filebeat</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <h4 class="font-semibold text-lg text-green-700">Filebeat (Agent L√©ger / "Shipper")</h4>
                            <ul class="list-disc list-inside text-sm text-slate-600 mt-2 space-y-1">
                                <li>√âcrit en Go : **Tr√®s l√©ger**, faible CPU/RAM.</li>
                                <li>S'installe sur **chaque** serveur.</li>
                                <li>R√¥le : Collecter et envoyer.</li>
                                <li>Transformation limit√©e (peut parser du JSON simple).</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <h4 class="font-semibold text-lg text-orange-700">Logstash (Processeur Lourd / "Processor")</h4>
                            <ul class="list-disc list-inside text-sm text-slate-600 mt-2 space-y-1">
                                <li>√âcrit en Java : **Lourd**, n√©cessite une JVM.</li>
                                <li>S'installe sur un **serveur central**.</li>
                                <li>R√¥le : Recevoir, transformer, filtrer, enrichir.</li>
                                <li>Transformation **tr√®s puissante** (Grok, GeoIP, mutations...).</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- AJOUT : Comparaison des Beats -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.6. Comparaison : Quel Beat choisir ?</h3>
                    <table class="w-full border border-slate-300 text-left text-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-2 border-r">Beat</th>
                                <th class="p-2 border-r">Type de Donn√©e</th>
                                <th class="p-2">Question √† laquelle il r√©pond</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Filebeat</td><td class="p-2 border-r">Logs (Lignes de texte)</td><td class="p-2">"Qu'est-il arriv√© ?" (ex: Erreur 404)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Metricbeat</td><td class="p-2 border-r">M√©triques (Nombres)</td><td class="p-2">"Comment va le syst√®me ?" (ex: CPU √† 80%)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Packetbeat</td><td class="p-2 border-r">R√©seau (Trames)</td><td class="p-2">"Combien de temps a pris la requ√™te ?" (ex: 120ms)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Heartbeat</td><td class="p-2 border-r">Disponibilit√© (Up/Down)</td><td class="p-2">"Le service est-il en ligne ?" (ex: Down)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Auditbeat</td><td class="p-2 border-r">Audit (S√©curit√©)</td><td class="p-2">"Qui a modifi√© ce fichier ?" (ex: 'root')</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Winlogbeat</td><td class="p-2 border-r">Logs √âv√©nements Windows</td><td class="p-2">"Qu'est-il arriv√© sur mon Active Directory ?"</td></tr>
                        </tbody>
                    </table>

                    <!-- AJOUT : Checkpoint Chapitre 6 -->
                    <div class="focus-box border-l-green-500 mt-6">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Chapitre 6</h3>
                        <p class="text-slate-700 mb-4">√Ä ce stade, si vous avez install√© Filebeat (Module System) et Metricbeat, vous devriez avoir plusieurs sources de donn√©es qui arrivent dans Elasticsearch.</p>
                        <p class="text-slate-700">Allez dans **Menu ‚ò∞ -> Stack Management -> Index Patterns**. Vous devriez √™tre capable de cr√©er au moins trois patterns diff√©rents :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>`apache-logstash-*` (de Logstash)</li>
                            <li>`filebeat-*` (des modules Filebeat)</li>
                            <li>`metricbeat-*` (de Metricbeat)</li>
                        </ul>
                    </div>
                </section>
                
                <!-- 7. Kibana -->
                <section id="kibana" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">7. Kibana - Visualisation et Dashboards</h1>
                    <p class="text-lg text-slate-600">Maintenant que nous avons des logs et des m√©triques, apprenons √† les explorer dans Kibana, l'interface de visualisation.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Th√©orie : Les 4 Piliers de Kibana</h3>
                    <ul class="list-decimal list-inside space-y-2 text-slate-600 mt-2">
                        <li><strong>Discover :</strong> L'outil de recherche et de filtrage pour inspecter les logs bruts (les "documents").</li>
                        <li><strong>Visualize :</strong> L'outil pour cr√©er un graphique (camembert, histogramme...) √† partir d'une recherche.</li>
                        <li><strong>Dashboard :</strong> Une collection de plusieurs visualisations assembl√©es sur une seule page.</li>
                        <li><strong>Dev Tools :</strong> Une console pour envoyer des requ√™tes brutes √† l'API d'Elasticsearch (tr√®s utile pour le d√©bogage).</li>
                    </ul>

                    <!-- AJOUT : Th√©orie Index Patterns -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.0. Th√©orie : Index Patterns & Donn√©es Temporelles</h3>
                    <div class="focus-box">
                        <h4 class="text-lg font-semibold text-slate-800">Index Patterns</h4>
                        <p class="text-slate-700 mb-2">C'est la fa√ßon dont Kibana "sait" quels index Elasticsearch interroger. C'est la premi√®re chose √† cr√©er.</p>
                        <ul class="list-disc list-inside text-slate-600 text-sm">
                            <li>Pattern `apache-logstash-*` : Interroge `apache-logstash-2025.11.03`, `apache-logstash-2025.11.04`, etc.</li>
                            <li>Pattern `metricbeat-*` : Interroge tous les index de Metricbeat.</li>
                        </ul>
                        <h4 class="text-lg font-semibold text-slate-800 mt-4">Donn√©es Temporelles (Time-based data)</h4>
                        <p class="text-slate-700 mb-2">La plupart des donn√©es dans Elastic sont temporelles. Kibana est centr√© sur le **Time Picker** (en haut √† droite), qui vous permet de filtrer la p√©riode (ex: "Last 15 minutes", "Last 7 days").</p>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.1. Pratique : Discover (Explorer)</h3>
                    <p class="text-slate-700">C'est votre loupe pour chercher dans les logs.</p>
                    <!-- AJOUT : Guidage UI -->
                    <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4">
                        <!-- MODIFI√â : Utilisation de l'IP de la VM -->
                        <li>Cliquez sur le menu ‚ò∞ en haut √† gauche (dans Kibana sur `http://[IP_DE_LA_VM]:5601`).</li>
                        <li>Dans la section "Analytics", cliquez sur **Discover**.</li>
                        <li>En haut √† gauche, sous la barre de recherche, assurez-vous que votre index pattern (ex: `apache-logstash-*`) est s√©lectionn√©.</li>
                        <li>Assurez-vous que le Time Picker (haut √† droite) est r√©gl√© sur une p√©riode o√π vous avez des donn√©es (ex: "Today").</li>
                    </ol>
                    <p class="text-slate-700 mt-4">La barre de recherche utilise le **KQL (Kibana Query Language)**. C'est tr√®s intuitif. Essayez ces requ√™tes :</p>
                    <div class="code-block">
<pre><code># Trouver toutes les erreurs 404
response: 404

# Trouver les requ√™tes d'une IP sp√©cifique (ou "::1" pour localhost)
clientip: "127.0.0.1"

# Combiner des filtres (requ√™tes GET qui n'√©taient PAS des 404)
verb: "GET" AND NOT response: 404

# Recherche num√©rique
bytes > 1000
</code></pre>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.2. Pratique : Visualize & Dashboard</h3>
                    <p class="text-slate-700">Cr√©ons un camembert montrant la r√©partition de nos codes de r√©ponse HTTP.</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4">
                        <li>Allez dans le menu ‚ò∞ -> **Visualize Library** -> "Create visualization".</li>
                        <li>Choisissez "Pie" (Camembert).</li>
                        <li>Choisissez la source de donn√©es `apache-logstash-*`.</li>
                        <li>Dans le panneau de droite "Buckets" (Compartiments), cliquez sur "Add" -> "Slice".</li>
                        <li>**Agr√©gation :** "Terms" (Termes).</li>
                        <li>**Field (Champ) :** `response.keyword` (Le `.keyword` est crucial : il signifie "valeur exacte", et non le texte analys√©).</li>
                        <li>Cliquez sur "Update".</li>
                    </ol>
                    <p class="text-slate-700 mt-4">Vous avez un camembert ! Sauvegardez-le ("Codes de r√©ponse").</p>
                    <p class="text-slate-700 mt-2">Ensuite, allez dans le menu ‚ò∞ -> **Dashboard** -> "Create dashboard". Cliquez sur "Add from library" et ajoutez votre camembert. Vous avez cr√©√© votre premier dashboard !</p>
                </section>
                
                <!-- 8. Cas Pratiques -->
                <section id="cas-pratiques" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">8. Cas Pratiques & Projet Final</h1>
                    <p class="text-lg text-slate-600">Appliquons tout ce que nous avons appris √† un projet concret : analyser des donn√©es ouvertes (Open Data).</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Projet : Analyse des Donn√©es de Transport Public</h3>
                    <p class="text-slate-700"><strong>Objectif :</strong> Utiliser Logstash pour importer un fichier CSV de donn√©es de transport (ex: ponctualit√© des bus/m√©tros) et cr√©er un dashboard de "Smart City".</p>
                    <p class="text-slate-700"><strong>Dataset :</strong> Un fichier CSV (ex: `ponctualite.csv`) que vous t√©l√©chargez depuis un portail Open Data (ex: data.gouv.fr).</p>
                    <p class="text-slate-700"><strong>Exemple de CSV :</strong></p>
                    <div class="code-block text-sm">
<pre><code>timestamp,ligne,station,coordonnees,retard_secondes
2025-11-03T08:30:15,M1,Chatelet,"48.858, 2.347",30
2025-11-03T08:31:02,Bus 69,Louvre,"48.860, 2.337",120
2025-11-03T08:32:10,M1,Gare de Lyon,"48.844, 2.373",0
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Template Logstash (Projet)</h4>
                    <p class="text-slate-700">Cr√©ez un `02-transport.conf` :</p>
                    <div class="code-block">
<pre><code class="language-ruby">input {
  file {
    path => "/chemin/vers/votre/ponctualite.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null" # Pour relire le fichier √† chaque test
    # ignore_older => 86400 # En production, pour ne pas relire les anciens fichiers
  }
}

filter {
  # Ignorer la premi√®re ligne (l'en-t√™te)
  if [message] =~ "timestamp,ligne" {
    drop { }
  }

  csv {
    separator => ","
    columns => ["timestamp","ligne","station","coordonnees","retard_secondes"]
  }

  # Convertir les types
  mutate {
    convert => { "retard_secondes" => "integer" }
  }

  # G√©rer la date
  date {
    match => [ "timestamp", "ISO8601" ] # ISO8601 g√®re "2025-11-03T08:30:15"
  }
  
  # G√©rer la g√©olocalisation
  # Le champ "coordonnees" (ex: "48.858, 2.347") doit √™tre s√©par√©
  grok {
    match => { "coordonnees" => "%{NUMBER:lat}, %{NUMBER:lon}" }
  }
  # Cr√©er le champ geoip.location au format "lat, lon"
  mutate {
    add_field => { "[geoip][location]" => "%{lat}, %{lon}" }
    # Convertir lat et lon en float pour ES
    convert => {
        "[geoip][location]" => "float"
    }
  }
  
  # Nettoyer les champs inutiles
  mutate {
    remove_field => ["message", "path", "host", "lat", "lon", "coordonnees"]
  }
}

output {
  elasticsearch {
    # MODIFI√â : Utilisation de localhost (Logstash et ES sont sur la m√™me VM)
    hosts => ["https://localhost:9200"]
    index => "transport-data" # Un seul index pour ce projet
    user => "elastic"
    password => "<VOTRE_MOT_DE_PASSE_ELASTIC>"
    ssl_verification_mode => "none"
  }
  stdout { codec => rubydebug }
}
</code></pre>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Objectifs du Dashboard Kibana</h4>
                    <p class="text-slate-700">Cr√©ez un dashboard "Smart City" avec :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>(Map)</strong> Une carte des stations (utilisant le champ `geoip.location`).</li>
                        <li><strong>(Line Chart)</strong> Une timeline du nombre de passages par heure.</li>
                        <li><strong>(Bar Chart)</strong> Un Top 10 des lignes les plus fr√©quent√©es.</li>
                        <li><strong>(Histogram)</strong> Une distribution des retards (pour voir si les retards sont de 30s ou 10min).</li>
                        <li><strong>(Metric)</strong> Le retard moyen (`Average` sur `retard_secondes`).</li>
                    </ul>
                </section>
                
                <!-- 9. Optimisation -->
                <section id="optimisation" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">9. Optimisation & Troubleshooting</h1>
                    <p class="text-lg text-slate-600">Votre stack fonctionne, mais elle est lente ou instable ? Voici les bases de l'optimisation.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Troubleshooting : Sant√© du Cluster (Rouge / Jaune / Vert)</h3>
                    <p class="text-slate-700">La commande `GET /_cluster/health` est vitale. Elle retourne un statut :</p>
                    <ul class="list-disc list-inside space-y-3 text-slate-700">
                        <li><span class="font-semibold text-green-600">Vert (Green) :</span> Tout va bien. Tous les shards principaux ET leurs r√©pliques sont allou√©s.</li>
                        <li><span class="font-semibold text-yellow-600">Jaune (Yellow) :</span> **Probl√®me courant.** Tous les shards principaux sont allou√©s (votre index fonctionne), mais une ou plusieurs **r√©pliques** n'ont pas pu √™tre assign√©es.
                            <br><span class="text-sm text-slate-600"><strong>Cause :</strong> Vous n'avez qu'un seul n≈ìud. ES ne peut pas placer la r√©plique sur le m√™me n≈ìud que le shard principal (panne). C'est normal en d√©veloppement.</span>
                            <br><span class="text-sm text-slate-600"><strong>Solution (en dev) :</strong> Mettre le nombre de r√©pliques √† 0 pour cet index.</span></li>
                        <li><span class="font-semibold text-red-600">Rouge (Red) :</span> **Grave.** Un ou plusieurs **shards principaux** ne sont pas allou√©s. Des donn√©es sont manquantes.
                            <br><span class="text-sm text-slate-600"><strong>Cause :</strong> Perte de plusieurs n≈ìuds, corruption de disque, pas assez d'espace disque.</span></li>
                    </ul>
                    <div class="code-block mt-2">
<pre><code class="language-json"># Forcer un index √† passer en vert (en dev, ne pas faire en prod)
PUT /mon-index-jaune/_settings
{
  "index": {
    "number_of_replicas": 0
  }
}
</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Gestion du Cycle de Vie (ILM)</h3>
                    <p class="text-slate-700">Vous ne pouvez pas garder tous les logs sur des SSD rapides (NVMe) √©ternellement. ILM (Index Lifecycle Management) automatise le d√©placement des donn√©es √† travers diff√©rents "tiers" (niveaux) de mat√©riel pour √©conomiser de l'argent.</p>
                    
                    <div class="space-y-4 mt-6">
                        <div class="ilm-tier ilm-hot">
                            <h5 class="font-bold text-lg text-red-800">1. Tier HOT (0-7 jours)</h5>
                            <p class="text-sm text-red-700">**Mat√©riel :** SSDs NVMe (tr√®s rapides)</p>
                            <p class="text-sm text-slate-700">**R√¥le :** Ingestion et recherche active. Les donn√©es d'aujourd'hui.</p>
                        </div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier ilm-warm">
                            <h5 class="font-bold text-lg text-orange-800">2. Tier WARM (7-30 jours)</h5>
                            <p class="text-sm text-orange-700">**Mat√©riel :** SSDs standards</p>
                            <p class="text-sm text-slate-700">**R√¥le :** Donn√©es moins consult√©es. L'index devient "read-only".</p>
                        </div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier ilm-cold">
                            <h5 class="font-bold text-lg text-blue-800">3. Tier COLD (30-90 jours)</h5>
                            <p class="text-sm text-blue-700">**Mat√©riel :** Disques durs HDD (lents, pas chers)</p>
                            <p class="text-sm text-slate-700">**R√¥le :** Donn√©es rarement consult√©es. (Utilise des "searchable snapshots").</p>
                        </div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier ilm-frozen">
                            <h5 class="font-bold text-lg text-gray-800">4. Tier FROZEN (90j - 1 an)</h5>
                            <p class="text-sm text-gray-700">**Mat√©riel :** Stockage objet (Amazon S3, Azure Blob)</p>
                            <p class="text-sm text-slate-700">**R√¥le :** Archive. Consultable tr√®s lentement.</p>
                        </div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier border-dashed border-slate-400 bg-slate-100">
                            <h5 class="font-bold text-lg text-slate-800">5. Delete (> 1 an)</h5>
                            <p class="text-sm text-slate-700">**R√¥le :** Supprimer automatiquement les donn√©es (RGPD).</p>
                        </div>
                    </div>
                </section>

                <!-- 10. Quiz Final -->
                <section id="quiz" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">10. Quiz Final</h1>
                    <p class="text-lg text-slate-600">Testez vos connaissances sur les concepts fondamentaux de la stack Elastic.</p>
                    
                    <div id="quiz-container" class="mt-8 space-y-6">
                        <!-- Les questions seront inject√©es ici par le JS -->
                    </div>
                    
                    <button id="quiz-submit" class="bg-sky-600 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:bg-sky-700 transition-colors">Valider mes r√©ponses</button>
                    
                    <div id="quiz-results" class="mt-6 hidden">
                        <h3 class="text-2xl font-semibold">R√©sultats : <span id="quiz-score" class="text-sky-700"></span></h3>
                        <p id="quiz-feedback" class="text-lg mt-2"></p>
                        <div id="quiz-details" class="mt-4 space-y-2"></div>
                    </div>
                </section>

                <!-- AJOUT : Annexe D√©pannage VM -->
                <section id="annexe-vm" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">Annexe : D√©pannage de la VM</h1>
                    <p class="text-lg text-slate-600">Probl√®mes courants sp√©cifiques √† notre environnement VirtualBox.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 1 : "VT-x is not available" au d√©marrage de la VM</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Cause :</strong> La virtualisation mat√©rielle n'est pas activ√©e dans le BIOS/UEFI de votre PC.</li>
                        <li><strong>Solution :</strong> Red√©marrez votre PC, entrez dans le BIOS (touche F2, F12, Suppr...), trouvez "Intel VT-x" ou "AMD-V" et "Activez" (Enable) l'option.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 2 : VM tr√®s lente</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Cause 1 :</strong> Pas assez de RAM allou√©e. Assurez-vous d'avoir donn√© au moins 4096 Mo √† la VM.</li>
                        <li><strong>Cause 2 (Windows) :</strong> Hyper-V est activ√© et entre en conflit avec VirtualBox.</li>
                        <li><strong>Solution (Hyper-V) :</strong> Ouvrez PowerShell en tant qu'administrateur et ex√©cutez `dism.exe /Online /Disable-Feature:Microsoft-Hyper-V-All`, puis red√©marrez.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 3 : Impossible d'acc√©der √† Kibana/Apache depuis le navigateur h√¥te</h3>
                    <p class="text-slate-700">Suivez ces √©tapes de d√©bogage :</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li><strong>Dans la VM :</strong> V√©rifiez l'IP. Avez-vous la bonne ?
                            <div class="code-block text-sm"><pre><code>ip addr show</code></pre></div>
                        </li>
                        <li><strong>Dans la VM :</strong> Le service √©coute-t-il sur la bonne interface ?
                            <div class="code-block text-sm"><pre><code>sudo netstat -tlnp | grep 5601</code></pre></div>
                            <p class="text-sm">Vous DEVEZ voir `0.0.0.0:5601` ou `:::5601`. Si vous voyez `127.0.0.1:5601`, Kibana n'√©coute pas √† l'ext√©rieur. (Voir Chap 4.2 pour corriger `server.host`).</p>
                        </li>
                        <li><strong>Dans la VM :</strong> Le pare-feu est-il activ√© ? (Il ne devrait pas l'√™tre par d√©faut).
                            <div class="code-block text-sm"><pre><code>sudo ufw status</code></pre></div>
                        </li>
                        <li><strong>Dans la VM :</strong> Pouvez-vous y acc√©der depuis la VM elle-m√™me ?
                            <div class="code-block text-sm"><pre><code>curl http://localhost:5601</code></pre></div>
                            <p class="text-sm">Si cela √©choue, Kibana a un probl√®me. Regardez les logs : `sudo journalctl -u kibana -f`</p>
                        </li>
                        <li><strong>Sur l'H√¥te :</strong> V√©rifiez votre pare-feu H√¥te (Windows Defender, etc.) qui pourrait bloquer la connexion sortante vers l'IP de la VM.</li>
                    </ol>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 4 : "VM runs out of disk space" (Plus d'espace disque)</h3>
                     <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Cause :</strong> Elasticsearch peut remplir le disque rapidement.</li>
                        <li><strong>Solution :</strong>
                            <div class="code-block text-sm">
<pre><code># V√©rifier l'espace
df -h

# Nettoyer les paquets t√©l√©charg√©s
sudo apt autoremove && sudo apt autoclean
</code></pre>
                            <p class="text-sm mt-2">Si le probl√®me persiste, vous devrez peut-√™tre √©tendre le disque virtuel dans les param√®tres de VirtualBox.</p>
                        </li>
                    </ul>
                </section>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- Gestion de la Navigation (Sidebar + Sections) ---
            const sections = document.querySelectorAll('.content-section');
            const links = document.querySelectorAll('.sidebar-link');
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const menuOverlay = document.getElementById('menu-overlay');
            const mainContent = document.querySelector('main.md\\:ml-72');

            function showSection(hash) {
                sections.forEach(section => {
                    if ('#' + section.id === hash) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                links.forEach(link => {
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                // Mettre √† jour le titre de la page
                const activeLink = document.querySelector(`.sidebar-link[href="${hash}"]`);
                if (activeLink) {
                    document.title = activeLink.innerText + ' - Cours Elastic';
                }

                // Fermer le menu mobile lors de la navigation
                if (window.innerWidth < 768) {
                    sidebar.classList.add('-translate-x-full');
                    menuOverlay.classList.add('opacity-0', 'hidden');
                }
            }

            links.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const hash = this.getAttribute('href');
                    if (window.location.hash !== hash) {
                        history.pushState(null, null, hash);
                    }
                    showSection(hash);
                    // Scroll to top of content area
                    mainContent.scrollTo(0, 0);
                });
            });

            // Gestion du menu mobile
            menuToggle.addEventListener('click', () => {
                sidebar.classList.remove('-translate-x-full');
                menuOverlay.classList.remove('opacity-0', 'hidden');
            });
            menuOverlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                menuOverlay.classList.add('opacity-0', 'hidden');
            });

            // Initial section load
            const initialHash = window.location.hash || '#setup-vm'; // MODIFI√â : D√©marrer au Chap 0
            showSection(initialHash);

            // Handle browser back/forward
            window.addEventListener('popstate', () => {
                showSection(window.location.hash || '#setup-vm');
            });

            // --- Gestion des Blocs de Code (Copie) ---
            document.querySelectorAll('.code-block').forEach(block => {
                const pre = block.querySelector('pre');
                // G√©rer les <pre><code> et les <pre> directs
                const codeElement = pre ? (pre.querySelector('code') || pre) : block;
                const code = codeElement.innerText;
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.innerText = 'Copier';
                
                copyBtn.addEventListener('click', () => {
                    const textarea = document.createElement('textarea');
                    textarea.value = code;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = 0;
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        copyBtn.innerText = 'Copi√© !';
                    } catch (err) {
                        copyBtn.innerText = 'Erreur';
                    }
                    document.body.removeChild(textarea);
                    
                    setTimeout(() => {
                        copyBtn.innerText = 'Copier';
                    }, 2000);
                });
                
                block.appendChild(copyBtn);
            });

            // --- Gestion du Quiz ---
            const quizContainer = document.getElementById('quiz-container');
            const quizSubmit = document.getElementById('quiz-submit');
            const quizResults = document.getElementById('quiz-results');
            const quizScore = document.getElementById('quiz-score');
            const quizFeedback = document.getElementById('quiz-feedback');
            const quizDetails = document.getElementById('quiz-details');

            const questions = [
                {
                    question: "Quel composant est le 'c≈ìur' de la stack, responsable du stockage et de l'indexation ?",
                    answers: { a: "Logstash", b: "Kibana", c: "Elasticsearch", d: "Filebeat" },
                    correct: "c"
                },
                {
                    question: "Quel composant est un agent l√©ger (√©crit en Go) con√ßu pour collecter des logs sur les serveurs clients ?",
                    answers: { a: "Logstash", b: "Filebeat", c: "Elasticsearch", d: "Kibana" },
                    correct: "b"
                },
                {
                    question: "Vous avez un log `[ERROR] DB Timeout`. Quel type de champ utiliseriez-vous pour le champ `status` afin de rechercher 'ERROR' ?",
                    answers: { a: "text", b: "keyword" },
                    correct: "b"
                },
                {
                    question: "Qu'est-ce que le filtre 'Grok' dans Logstash ?",
                    answers: { a: "Un moyen de compresser les logs", b: "Un moyen de parser du texte non structur√© en champs", c: "Un moyen de crypter les donn√©es", d: "Un moyen d'envoyer des alertes" },
                    correct: "b"
                },
                {
                    question: "Votre cluster est 'Jaune' (Yellow). Qu'est-ce que cela signifie le plus probablement ?",
                    answers: { a: "Tout va bien", b: "Un shard principal est manquant, vos donn√©es sont incompl√®tes", c: "Un shard de r√©plique n'a pas pu √™tre allou√© (ex: 1 seul n≈ìud)", d: "Kibana est d√©connect√©" },
                    correct: "c"
                }
            ];

            // Afficher les questions
            questions.forEach((q, i) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'p-4 bg-white rounded-lg shadow border border-slate-200';
                
                let answersHtml = '<div class="mt-3 space-y-2">';
                for (const [key, value] of Object.entries(q.answers)) {
                    answersHtml += `
                        <label class="block">
                            <input type="radio" name="question${i}" value="${key}" class="mr-2">
                            ${value}
                        </label>
                    `;
                }
                answersHtml += '</div>';
                
                questionDiv.innerHTML = `
                    <p class="font-semibold text-slate-800">${i + 1}. ${q.question}</p>
                    ${answersHtml}
                `;
                quizContainer.appendChild(questionDiv);
            });

            // Valider le quiz
            quizSubmit.addEventListener('click', () => {
                let score = 0;
                quizDetails.innerHTML = '';
                
                questions.forEach((q, i) => {
                    const selected = document.querySelector(`input[name="question${i}"]:checked`);
                    const detail = document.createElement('div');
                    detail.className = 'p-3 rounded-md';

                    if (selected) {
                        if (selected.value === q.correct) {
                            score++;
                            detail.classList.add('bg-green-100', 'border', 'border-green-300');
                            detail.innerHTML = `<span class="font-semibold text-green-700">Question ${i + 1}: Correct.</span>`;
                        } else {
                            detail.classList.add('bg-red-100', 'border', 'border-red-300');
                            detail.innerHTML = `<span class="font-semibold text-red-700">Question ${i + 1}: Incorrect.</span> La bonne r√©ponse √©tait : <strong>${q.answers[q.correct]}</strong>.`;
                        }
                    } else {
                        detail.classList.add('bg-yellow-100', 'border', 'border-yellow-300');
                        detail.innerHTML = `<span class="font-semibold text-yellow-700">Question ${i + 1}: Non r√©pondue.</span> La bonne r√©ponse √©tait : <strong>${q.answers[q.correct]}</strong>.`;
                    }
                    quizDetails.appendChild(detail);
                });

                quizScore.innerText = `${score} / ${questions.length}`;
                if (score === questions.length) {
                    quizFeedback.innerText = "Parfait ! Vous ma√Ætrisez les concepts cl√©s.";
                } else if (score >= questions.length / 2) {
                    quizFeedback.innerText = "Bon travail ! Relisez les points que vous avez manqu√©s.";
                } else {
                    quizFeedback.innerText = "Continuez √† r√©viser, certains concepts de base sont √† revoir.";
                }
                quizResults.classList.remove('hidden');
            });

        });
    </script>
</body>
</html>

