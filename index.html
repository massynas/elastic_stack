<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours (Enrichi Cluster+) - Elastic Stack v8.x</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 
    Structure du Cours (Bas√©e sur les recommandations)
    0. Pr√©requis (VM Standardis√©e, Planning)
    1. Introduction (Contexte M√©tier)
    1.5. Th√©orie des Logs
    2. Architecture
    3. ES Fondamentaux (Th√©orie + Analyzers + Images)
    4. Installation (Pratique - Apache D√âTAILL√â, '√† l'ancienne', ES, Kibana + Images)
    5. Logstash (Th√©orie + Pratique + Images + D√©fi)
    6. Beats (Th√©orie + Pratique guid√©e + Images + D√©fi)
    7. Kibana (Th√©orie + Pratique guid√©e par images + D√©fi)
    8. Cas Pratiques (Projet Open Data + Partage)
    9. Optimisation (Mappings Avanc√©s, Sharding, ILM, Troubleshooting, Backup)
    10. Quiz (Avec Badges)
    Annexes: D√©pannage, FAQ, Glossaire, Ressources
    Pour Aller Plus Loin: (Ressources + Cluster + Firewall)
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        .code-block {
            position: relative;
            background-color: #1f2937; /* gray-800 */
            color: #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            overflow-x: auto;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
        }
        .code-block .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #374151; /* gray-700 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem; /* rounded */
            font-size: 0.75rem; /* text-xs */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .code-block .copy-btn:hover {
            background-color: #4b5563; /* gray-600 */
        }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; /* slate-100 */ }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; /* slate-300 */ border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; /* slate-400 */ }

        .sidebar-link.active {
            background-color: #e0f2fe; /* sky-100 */
            color: #0c4a6e; /* sky-800 */
            font-weight: 600;
        }
        .sidebar-title {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* semibold */
            color: #64748b; /* slate-500 */
            text-transform: uppercase;
            letter-spacing: 0.05em; /* tracking-wider */
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            margin-top: 1rem; /* mt-4 */
        }
        
        /* Styles pour les diagrammes */
        .diagram-box {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background-color: #f8fafc; /* slate-50 */
            border: 1px solid #e2e8f0; /* slate-200 */
            display: flex; flex-direction: column; align-items: center;
            min-width: 90px;
            transition: all 0.2s;
        }
        .diagram-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-color: #0ea5e9; /* sky-500 */
        }
        .diagram-arrow { 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem; /* text-4xl */
            color: #94a3b8; /* slate-400 */
            transform: rotate(90deg); /* Fl√®che vers le bas par d√©faut pour mobile */
        }
        @media (min-width: 768px) { 
            .diagram-arrow { 
                transform: rotate(0deg); /* Fl√®che vers la droite sur desktop */
                min-width: 50px;
            } 
        }

        /* Styles pour les Tiers ILM */
        .ilm-tier {
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border-width: 2px;
        }
        .ilm-hot { border-color: #ef4444; background-color: #fee2e2; }
        .ilm-warm { border-color: #f97316; background-color: #ffedd5; }
        .ilm-cold { border-color: #3b82f6; background-color: #dbeafe; }
        .ilm-frozen { border-color: #64748b; background-color: #f1f5f9; }
        
        /* Styles pour Sharding Diagram */
        .node-box {
            background-color: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem;
        }
        .shard-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border-radius: 0.25rem;
            font-weight: 600;
            margin: 0.25rem;
        }
        .shard-p { background-color: #dbeafe; border: 1px solid #93c5fd; color: #1e40af; } /* Primary */
        .shard-r { background-color: #e5e7eb; border: 1px solid #9ca3af; color: #374151; } /* Replica */
        
        .focus-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-left-width: 4px;
            border-left-color: #0ea5e9; /* sky-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
        }
        
        /* STYLES pour les encadr√©s interactifs */
        .challenge-box {
            background-color: #fffbeb; /* yellow-50 */
            border: 1px solid #fde68a; /* yellow-200 */
            border-left-width: 4px;
            border-left-color: #f59e0b; /* yellow-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
            margin-top: 1.5rem;
        }
        .anecdote-box {
            background-color: #ecfdf5; /* green-50 */
            border: 1px solid #a7f3d0; /* green-200 */
            border-left-width: 4px;
            border-left-color: #10b981; /* green-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
            margin-top: 1.5rem;
        }
        .share-box {
            background-color: #f0f9ff; /* sky-50 */
            border: 1px solid #bae6fd; /* sky-200 */
            border-left-width: 4px;
            border-left-color: #0ea5e9; /* sky-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
            margin-top: 1.5rem;
        }
        .tip-box {
            background-color: #f5f3ff; /* violet-50 */
            border: 1px solid #ddd6fe; /* violet-200 */
            border-left-width: 4px;
            border-left-color: #8b5cf6; /* violet-500 */
            padding: 1rem;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
            margin-top: 1.5rem;
        }


        /* Styles pour le Glossaire et FAQ */
        .faq-question {
            font-weight: 600;
            color: #1e3a8a; /* blue-900 */
        }
        .glossary-term {
            font-weight: 600;
            color: #1e3a8a; /* blue-900 */
        }

        /* Style pour les images int√©gr√©es */
        .course-image {
            width: 100%;
            border-radius: 0.5rem; /* rounded-lg */
            border: 1px solid #e2e8f0; /* slate-200 */
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-slate-50">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-72 bg-white border-r border-slate-200 h-screen overflow-y-auto fixed top-0 left-0 z-10 -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out" id="sidebar">
            <div class="p-6">
                <h2 class="text-xl font-bold text-sky-900">Cours Elastic v8.x</h2>
                <p class="text-sm text-slate-500">Structure Enrichie</p>
            </div>
            <nav class="mt-4 px-3">
                <ul class="space-y-1">
                    <li class="sidebar-title">Pr√©requis</li>
                    <li><a href="#setup-vm" class="sidebar-link active group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">0. Pr√©requis : Environnement VM</a></li>

                    <li class="sidebar-title">Introduction</li>
                    <li><a href="#intro" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">1. Introduction √† ELK</a></li>
                    <li><a href="#theorie-logs" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">1.5. Th√©orie des Logs (Le "Pourquoi")</a></li>
                    <li><a href="#architecture" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">2. Architecture Globale</a></li>

                    <li class="sidebar-title">Elasticsearch</li>
                    <li><a href="#es-fondamentaux" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">3. ES - Fondamentaux</a></li>
                    <li><a href="#installation" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">4. Installation & Admin</a></li>

                    <li class="sidebar-title">Ingestion</li>
                    <li><a href="#logstash" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">5. Logstash</a></li>
                    <li><a href="#beats" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">6. La Famille Beats</a></li>

                    <li class="sidebar-title">Visualisation</li>
                    <li><a href="#kibana" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">7. Kibana</a></li>
                    
                    <li class="sidebar-title">Ma√Ætrise</li>
                    <li><a href="#cas-pratiques" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">8. Cas Pratiques</a></li>
                    <li><a href="#optimisation" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">9. Optimisation</a></li>
                    
                    <li class="sidebar-title">√âvaluation</li>
                    <li><a href="#quiz" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">10. Quiz Final</a></li>

                    <li class="sidebar-title">Annexes</li>
                    <li><a href="#annexe-vm" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">Annexe : D√©pannage VM</a></li>
                    <li><a href="#annexe-faq" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">Annexe : FAQ</a></li>
                    <li><a href="#annexe-glossaire" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">Annexe : Glossaire</a></li>
                    <li><a href="#aller-plus-loin" class="sidebar-link group flex items-center px-3 py-2 text-slate-700 hover:bg-slate-100 rounded-md text-sm font-medium">Pour Aller Plus Loin</a></li>
                </ul>
            </nav>
            <div class="p-6 h-20"></div> <!-- Espace pour le scroll -->
        </aside>

        <!-- Main content -->
        <main class="flex-1 overflow-y-auto pt-16 md:pt-0 md:ml-72">
            
            <!-- Bouton Menu Burger pour mobile -->
            <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-20 p-2 bg-white rounded-md shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            
            <!-- Overlay pour fermer le menu sur mobile -->
            <div id="menu-overlay" class="md:hidden fixed inset-0 bg-black/50 z-0 opacity-0 transition-opacity duration-300 hidden"></div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                
                <!-- 0. Pr√©requis VM -->
                <section id="setup-vm" class="content-section space-y-6">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">0. Pr√©requis et Configuration de l'Environnement</h1>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.1. Pourquoi une Machine Virtuelle ?</h3>
                    <p class="text-slate-700"><strong>Probl√®me :</strong> Chaque √©tudiant a un environnement diff√©rent (Windows 10/11, macOS, Ubuntu, Fedora...). Les instructions d'installation varient, les versions de Java diff√®rent, les permissions sont diff√©rentes.</p>
                    <p class="text-slate-700 mt-2"><strong>Solution :</strong> Nous allons tous utiliser <strong>exactement la m√™me machine virtuelle Linux</strong> pour garantir que le cours se d√©roule sans accroc.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.2. Configuration Requise de la Machine H√¥te</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>RAM :</strong> 8 Go minimum (16 Go recommand√©)</li>
                        <li><strong>Processeur :</strong> Support de la virtualisation (Intel VT-x ou AMD-V)</li>
                        <li><strong>Disque :</strong> 50 Go d'espace libre</li>
                    </ul>
                    <p class="text-slate-700 mt-2"><strong>V√©rification (Windows) :</strong> Gestionnaire des t√¢ches -> "Performance" -> "Processeur". "Virtualisation" doit √™tre "Activ√©e". (Sinon, activez-la dans le BIOS/UEFI).</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.3. Installation de VirtualBox</h3>
                    <p class="text-slate-700">T√©l√©chargez et installez VirtualBox depuis le site officiel. Red√©marrez si demand√©.</p>
                    
                    <div class="focus-box border-l-purple-500 mt-6">
                        <h3 class="text-xl font-semibold text-purple-900 mb-4">Planning Recommand√© (Auto-formation)</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li><strong>Semaine 1 : Les Fondations</strong>
                                <ul class="list-disc list-inside ml-6 text-sm">
                                    <li>Objectif : Avoir une stack fonctionnelle.</li>
                                    <li>Chapitres : 0 √† 4.</li>
                                    <li>Livrable : La stack est install√©e, le checkpoint 4.3 est valid√©.</li>
                                </ul>
                            </li>
                            <li><strong>Semaine 2 : L'Ingestion</strong>
                                <ul class="list-disc list-inside ml-6 text-sm">
                                    <li>Objectif : Ma√Ætriser l'ingestion de donn√©es (logs & m√©triques).</li>
                                    <li>Chapitres : 5 et 6.</li>
                                    <li>Livrable : Les logs Apache (Logstash) et les m√©triques (Metricbeat) arrivent dans Kibana.</li>
                                </ul>
                            </li>
                             <li><strong>Semaine 3 : La Visualisation et le Projet</strong>
                                <ul class="list-disc list-inside ml-6 text-sm">
                                    <li>Objectif : Analyser et pr√©senter les donn√©es.</li>
                                    <li>Chapitres : 7, 8 et 9.</li>
                                    <li>Livrable : Le projet Open Data (Chap. 8) est termin√© et pr√©sent√©.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.4. T√©l√©chargement des Outils Officiels</h3>
                    
                    <div class="focus-box border-l-green-500">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">Ressources Cl√©s (T√©l√©chargement)</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>
                                <strong>VirtualBox :</strong> 
                                <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" class="text-sky-600 underline">virtualbox.org/wiki/Downloads</a>
                            </li>
                            <li>
                                <strong>Ubuntu Server 22.04 LTS :</strong> 
                                <a href="https://ubuntu.com/download/server" target="_blank" class="text-sky-600 underline">ubuntu.com/download/server</a> (Prenez l'option "Manual server installation")
                            </li>
                        </ul>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.5. Cr√©ation de la Machine Virtuelle ("From Scratch")</h3>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li>Ouvrez VirtualBox et cliquez sur "Nouvelle".</li>
                        <li><strong>Nom :</strong> `ElasticStack-VM`</li>
                        <li><strong>Image ISO :</strong> S√©lectionnez l'ISO d'Ubuntu Server 22.04.</li>
                        <li>Cochez "Installer en mode 'unattended'" (Installation non assist√©e).</li>
                        <li><strong>Utilisateur :</strong> `elastic-student` | <strong>Mot de passe :</strong> `Formation2025!`</li>
                        <li><strong>Configuration Mat√©rielle :</strong> Allouez au moins **4 Go (4096 Mo) de RAM** et **2 c≈ìurs de CPU**.</li>
                        <li><strong>Disque Dur :</strong> Cr√©ez un disque de **40 Go** (taille dynamique).</li>
                        <li>Suivez l'assistant. L'installation d'Ubuntu va d√©marrer (cela peut prendre 10-15 minutes).</li>
                    </ol>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.6. Configuration R√©seau de la VM</h3>
                    <div class="focus-box">
                        <h4 class="text-lg font-semibold text-slate-800">Acc√®s par Pont (Recommand√©)</h4>
                        <ol class="list-decimal list-inside space-y-2 text-slate-700 text-sm">
                            <li>S√©lectionnez votre VM (√©teinte) -> "Configuration" -> "R√©seau".</li>
                            <li>"Mode d'acc√®s r√©seau" : <strong>Acc√®s par pont (Bridged Adapter)</strong>.</li>
                            <li>"Nom" : S√©lectionnez votre carte r√©seau principale (Wi-Fi ou Ethernet).</li>
                        </ol>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.7. Premier D√©marrage et Configuration</h3>
                    <p class="text-slate-700">Connectez-vous √† votre VM (`elastic-student` / `Formation2025!`).</p>
                    <p class="text-slate-700 mt-2">Mettez √† jour le syst√®me et installez Java 11 (pr√©-requis Elastic) :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt update && sudo apt upgrade -y
sudo apt install openjdk-11-jdk -y
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">V√©rifiez l'installation de Java :</p>
                    <div class="code-block">
<pre><code class="language-bash">java -version
# Doit afficher : openjdk version "11.0.x"
</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.8. Configuration SSH (Acc√®s Confort)</h3>
                    <p class="text-slate-700">Installez SSH sur la VM pour pouvoir copier-coller les commandes depuis votre machine h√¥te.</p>
                    <div class="code-block">
<pre><code class="language-bash"># Dans la VM
sudo apt install openssh-server -y
sudo systemctl enable ssh
ip addr show # Notez l'adresse IP (ex: 192.168.1.150)
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">Depuis votre machine **h√¥te** (PowerShell, Terminal, etc.) :</p>
                    <div class="code-block">
<pre><code class="language-bash">ssh elastic-student@[IP_DE_LA_VM]
</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.9. Snapshot de Sauvegarde (Crucial)</h3>
                    <div class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg">
                        <p class="font-semibold">TR√àS IMPORTANT :</p>
                        <ol class="list-decimal list-inside space-y-1 text-sm mt-2">
                            <li>√âteignez votre VM.</li>
                            <li>Dans VirtualBox, s√©lectionnez votre VM -> "Snapshots" -> "Prendre".</li>
                            <li>Nom : "VM Propre - Avant Cours"</li>
                        </ol>
                        <p class="text-sm mt-2">Si vous cassez quelque chose, vous pourrez revenir √† cet √©tat propre.</p>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">0.10. Validation de l'Environnement</h3>
                    <div class="focus-box border-l-green-500">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Avant de Commencer</h3>
                        <p class="text-slate-700 mb-4">Ex√©cutez ces commandes manuelles pour valider que votre environnement est pr√™t :</p>
                        <div class="code-block">
<pre><code class="language-bash">java -version   # Doit afficher Java 11
free -h         # Doit afficher > 3.5Go de RAM
df -h /         # Doit afficher > 30Go de disque
ping -c 1 google.com # Doit r√©pondre
</code></pre>
                        </div>
                    </div>

                </section>

                <!-- 1. Introduction -->
                <section id="intro" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">1. Introduction √† la Suite Elastic (ELK)</h1>
                    <p class="text-lg text-slate-600">Bienvenue dans ce cours sur la stack Elastic 8.x ! Nous allons transformer des donn√©es brutes en informations pr√©cieuses. Ce guide interactif vous accompagnera de la th√©orie fondamentale √† la cr√©ation de dashboards complexes.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900">Les 3 Composants Historiques (ELK)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">üóÑÔ∏è</span>
                            <h4 class="text-xl font-semibold text-blue-800 mt-2">Elasticsearch</h4>
                            <p class="text-slate-600 mt-2">Le **c≈ìur** de la stack. Un moteur de recherche et d'analyse distribu√©. Il stocke, indexe et rend les donn√©es consultables √† une vitesse fulgurante.</p>
                        </div>
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">‚öôÔ∏è</span>
                            <h4 class="text-xl font-semibold text-orange-800 mt-2">Logstash</h4>
                            <p class="text-slate-600 mt-2">Le **pipeline** de traitement. Un outil c√¥t√© serveur qui ing√®re les donn√©es de multiples sources, les transforme (parse, enrichit) et les envoie vers Elasticsearch.</p>
                        </div>
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-slate-200">
                            <span class="text-4xl">üìä</span>
                            <h4 class="text-xl font-semibold text-green-800 mt-2">Kibana</h4>
                            <p class="text-slate-600 mt-2">L'**interface** de visualisation. L'outil web qui vous permet d'explorer, de visualiser (graphiques, cartes) et de cr√©er des dashboards avec vos donn√©es.</p>
                        </div>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">... Et l'√âvolution : Les Beats</h3>
                    <p class="text-slate-600">Depuis, la famille s'est agrandie avec les **Beats** : des agents l√©gers con√ßus pour collecter des types de donn√©es sp√©cifiques (logs, m√©triques, etc.) directement depuis vos serveurs.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Histoire et √âvolution</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>2010 :</strong> Shay Banon cr√©e Elasticsearch.</li>
                        <li><strong>2012 :</strong> Jordan Sissel cr√©e Logstash.</li>
                        <li><strong>2013 :</strong> Rashid Khan cr√©e Kibana.</li>
                        <li><strong>2014 :</strong> Elastic (l'entreprise) est fond√©e.</li>
                        <li><strong>2015 :</strong> Introduction des Beats.</li>
                        <li><strong>2021 :</strong> Changement de licence (Elastic License v2 & SSPL).</li>
                    </ul>
                </section>
                
                <!-- 1.5. Th√©orie des Logs (Le 'Pourquoi') -->
                <section id="theorie-logs" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">1.5. Comprendre les Logs (Le "Pourquoi")</h1>
                    <p class="text-lg text-slate-600">Avant de plonger dans la technique, comprenons pourquoi les logs sont l'une des ressources les plus pr√©cieuses d'une entreprise.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Qu'est-ce qu'un Log ?</h3>
                    <p class="text-slate-700"><strong>D√©finition simple :</strong> Un log est un "journal" automatique d'√©v√©nements qu'√©crit un programme ou un syst√®me.</p>
                    <div class="code-block text-sm">
<pre><code>"2025-11-03 09:15:32 : Page '/index.html' visit√©e depuis IP 192.168.1.100"
"2025-11-03 10:00:45 : ERREUR : Fichier 'config.php' introuvable"</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Pourquoi les Logs sont-ils Cruciaux ?</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-blue-700">1. D√©bogage (Debug)</h4>
                            <p class="text-slate-600 text-sm mt-1">Quand un site plante, le log dit pourquoi.</p>
                            <code class="text-xs text-red-600 block mt-1">[ERROR] Database connection failed: Timeout</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-red-700">2. S√©curit√© (SIEM)</h4>
                            <p class="text-slate-600 text-sm mt-1">D√©tecter les attaques en temps r√©el.</p>
                            <code class="text-xs text-red-600 block mt-1">[WARN] Failed login 'admin' from IP 1.2.3.4 (3 attempts)</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-green-700">3. Performance (APM)</h4>
                            <p class="text-slate-600 text-sm mt-1">R√©v√©ler les goulots d'√©tranglement.</p>
                            <code class="text-xs text-orange-600 block mt-1">[INFO] Page '/produits' loaded in 5.2s (DB: 4.8s)</code>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h4 class="font-semibold text-lg text-purple-700">4. Business Intelligence</h4>
                            <p class="text-slate-600 text-sm mt-1">Donner des insights m√©tier.</p>
                            <code class="text-xs text-purple-600 block mt-1">[INFO] "GET /produit/iphone-15" 200</code>
                        </div>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Le Probl√®me : L'Explosion des Logs</h3>
                    <p class="text-slate-700">Sans outil, il est impossible de r√©pondre √† des questions simples : "Pourquoi le site √©tait-il lent hier √† 15h ?"</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">La Solution : Centralisation et Analyse</h3>
                    <p class="text-slate-700">C'est exactement le r√¥le de la **Stack Elastic** :</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li><strong>Collecter</strong> tous les logs dispers√©s (Beats/Logstash).</li>
                        <li><strong>Centraliser</strong> dans un moteur de recherche (Elasticsearch).</li>
                        <li><strong>Visualiser</strong> avec des graphiques (Kibana).</li>
                    </ol>
                   <div class="anecdote-box">
  <h3 class="text-xl font-semibold text-sky-900 mb-2">
    üí° Le D√©fi de l'Observabilit√© dans les Syst√®mes Distribu√©s
  </h3>

  <p class="text-slate-700">
    <span class="font-semibold text-sky-800">L'√©volution des architectures logicielles</span>, 
    passant de syst√®mes monolithiques centralis√©s √† des √©cosyst√®mes de microservices distribu√©s, 
    a fondamentalement transform√© les d√©fis li√©s √† la surveillance et √† la maintenance des applications.
    <br><br>

    Dans une <span class="font-semibold text-sky-800">architecture monolithique</span>, 
    les journaux d'√©v√©nements (logs) √©taient g√©n√©ralement stock√©s dans des fichiers sur un seul serveur.  
    L'analyse et le d√©pannage, bien que parfois fastidieux, se limitaient souvent √† se connecter √† ce serveur via SSH 
    et √† utiliser des outils en ligne de commande comme <code>grep</code> pour rechercher des informations pertinentes.  
    <br>
    Cette approche est devenue <span class="font-semibold text-red-700">obsol√®te</span> face √† la complexit√© des environnements modernes.
    <br><br>

    Les <span class="font-semibold text-sky-800">syst√®mes distribu√©s</span>, 
    qui composent l'infrastructure de la plupart des entreprises technologiques aujourd'hui, 
    sont constitu√©s de centaines, voire de milliers de services interconnect√©s, 
    souvent ex√©cut√©s dans des conteneurs √©ph√©m√®res sur des plateformes cloud.  
    <br>
    Dans un tel environnement, les logs sont g√©n√©r√©s de mani√®re d√©centralis√©e sur une multitude de machines virtuelles et de conteneurs 
    qui peuvent √™tre cr√©√©s et d√©truits dynamiquement.  
    <br>
    Tenter de suivre les logs en se connectant manuellement √† chaque n≈ìud est non seulement <span class="italic">impraticable</span>, 
    mais <span class="font-semibold text-red-700">impossible</span>.
    <br><br>

    Ce contexte a donn√© naissance au concept d‚Äô<span class="font-semibold text-sky-800">observabilit√©</span>, 
    qui repose sur trois piliers fondamentaux :
    <span class="italic">les logs</span>, 
    <span class="italic">les m√©triques (metrics)</span> et 
    <span class="italic">les traces (traces)</span>.  
    <br>
    La <span class="font-semibold text-sky-800">journalisation centralis√©e</span> 
    est la pierre angulaire de cette approche, 
    car elle permet de collecter, d‚Äôagr√©ger et d‚Äôanalyser l‚Äôensemble des logs g√©n√©r√©s par une infrastructure en un seul endroit, 
    offrant une <span class="font-semibold text-sky-800">vue unifi√©e</span> indispensable pour le monitoring, le d√©pannage et l‚Äôanalyse de s√©curit√©.
    <br><br>

    La <span class="font-semibold text-sky-800">gestion des logs √† grande √©chelle</span> 
    a cess√© d‚Äô√™tre une simple t√¢che d‚Äôadministration syst√®me 
    pour devenir un <span class="font-semibold text-sky-800">probl√®me complexe d‚Äôing√©nierie des donn√©es en temps r√©el</span>.  
    <br>
    Le d√©fi n‚Äôest plus seulement de capturer du texte, 
    mais de g√©rer un flux continu de donn√©es semi-structur√©es √† tr√®s haut volume et √† haute v√©locit√©.
    <br><br>

    Initialement, le probl√®me √©tait <span class="italic">l‚Äôacc√®s aux fichiers de logs</span>.  
    Avec la distribution des syst√®mes, il est devenu un <span class="italic">probl√®me d‚Äôagr√©gation</span>.  
    √Ä l‚Äô√©chelle d‚Äôentreprises comme <span class="font-semibold text-sky-800">Netflix</span>, 
    qui traitent des p√©taoctets de donn√©es, 
    le d√©fi se transforme en un <span class="font-semibold text-sky-800">probl√®me de traitement de flux (stream processing)</span>.
    <br><br>

    Le volume de donn√©es est tel qu‚Äôil ne peut √™tre g√©r√© par de simples outils de collecte ;  
    il n√©cessite un <span class="font-semibold text-sky-800">pipeline de donn√©es robuste</span> 
    capable d‚Äôingestion, de mise en m√©moire tampon (buffering), de transformation et de routage en temps quasi r√©el.
    <br><br>

    Par cons√©quent, les outils et les principes du <span class="font-semibold text-sky-800">Big Data</span>, 
    tels que <span class="font-semibold text-orange-600">Apache Kafka</span> pour le buffering 
    et des bases de donn√©es distribu√©es comme <span class="font-semibold text-orange-600">Elasticsearch</span> pour le stockage, 
    deviennent des composants <span class="font-semibold text-green-700">essentiels</span> et non plus optionnels.
  </p>
</div>


                    <div class="anecdote-box">
                         <h3 class="text-xl font-semibold text-green-900 mb-2">üí° Le savais-tu ? L'origine d'Elasticsearch</h3>
                         <p class="text-slate-700">Shay Banon, le cr√©ateur d'Elasticsearch, a commenc√© √† le d√©velopper en 2010 non pas pour des logs, mais pour aider sa femme (cheffe cuisini√®re) √† cr√©er une application de recherche de recettes. La puissance du moteur de recherche s'est av√©r√©e parfaite pour... les logs !</p>
                    </div>
                </section>

                <!-- 2. Architecture Globale -->
                <section id="architecture" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">2. Architecture Globale</h1>
                    <p class="text-lg text-slate-600">Comprendre comment les donn√©es circulent est essentiel.</p>
                    
                    <div class="p-6 bg-white rounded-xl shadow-lg mt-4">
                        <h4 class="font-semibold text-lg text-slate-800">1. Architecture "Flexible" : Beats ‚Üí Logstash ‚Üí Elasticsearch</h4>
                        <p class="text-sm text-slate-600 mb-4">L'architecture la plus courante. N√©cessaire pour parser des logs "custom" ou enrichir des donn√©es.</p>
                        <div class="flex flex-col md:flex-row items-center justify-around">
                            <div class="diagram-box" title="Serveurs Sources"><span class="text-2xl">üìà</span> <span class="text-xs font-medium">Beats</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Transformation"><span class="text-2xl">‚öôÔ∏è</span> <span class="text-xs font-medium">Logstash</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Stockage"><span class="text-2xl">üóÑÔ∏è</span> <span class="text-xs font-medium">Elasticsearch</span></div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box" title="Visualisation"><span class="text-2xl">üìä</span> <span class="text-xs font-medium">Kibana</span></div>
                        </div>
                    </div>
                    
                    <div class="focus-box mt-6">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Focus Th√©orique : Quand se passer de Logstash ?</h3>
                        <p class="text-slate-700">Vous pouvez envoyer les Beats directement √† Elasticsearch si :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                            <li>Vous utilisez un **Module Beats** (ex: Nginx, MySQL) qui g√®re le parsing.</li>
                            <li>Vos logs sont d√©j√† en format JSON propre.</li>
                        </ul>
                    </div>

                </section>
                
                <!-- 3. ES - Fondamentaux -->
                <section id="es-fondamentaux" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">3. Elasticsearch - Fondamentaux</h1>
                    <p class="text-lg text-slate-600">Plongeons dans le c≈ìur du r√©acteur.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Terminologie : SQL vs Elasticsearch</h3>
                    <table class="w-full border border-slate-300 text-left">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-3 border-r">Monde SQL</th>
                                <th class="p-3">Monde Elasticsearch</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Table</td><td class="p-3 font-semibold">Index</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Ligne</td><td class="p-3 font-semibold">Document (JSON)</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Colonne</td><td class="p-3 font-semibold">Champ (Field)</td></tr>
                            <tr class="border-b"><td class="p-3 border-r font-semibold">Sch√©ma</td><td class="p-3 font-semibold">Mapping</td></tr>
                        </tbody>
                    </table>

                    <div class="p-6 bg-white rounded-xl shadow-lg mt-6">
                        <h3 class="text-2xl font-semibold text-sky-900 mb-4">Le Secret de la Vitesse : L'Index Invers√©</h3>
                        <p class="text-slate-700 mb-4">Comment ES trouve-t-il un mot dans 1 milliard de documents en millisecondes ? Il utilise un index (comme √† la fin d'un livre).</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-slate-800">Documents :</h4>
                                <p class="font-mono bg-sky-100 px-2 py-1 rounded">Doc 1: "Le renard brun."</p>
                                <p class="font-mono bg-green-100 px-2 py-1 rounded mt-2">Doc 2: "Le renard saute."</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-slate-800">Index Invers√© (Simplifi√©) :</h4>
                                <table class="w-full border border-slate-300 text-left text-sm mt-2">
                                    <thead class="bg-slate-100"><tr><th class="p-2">Terme</th><th class="p-2">Documents</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td class="p-2">"brun"</td><td class="p-2"><span class="bg-sky-100 px-2 py-1 rounded">Doc 1</span></td></tr>
                                        <tr class="border-b"><td class="p-2">"renard"</td><td class="p-2"><span class="bg-sky-100 px-2 py-1 rounded">Doc 1</span>, <span class="bg-green-100 px-2 py-1 rounded">Doc 2</span></td></tr>
                                        <tr class="border-b"><td class="p-2">"saute"</td><td class="p-2"><span class="bg-green-100 px-2 py-1 rounded">Doc 2</span></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="focus-box mt-6">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Concept Cl√© : Analyse (`text` vs `keyword`)</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                            <li><strong>`text` :</strong> Le champ est **analys√©**. "Le renard brun" est d√©coup√© en `["le", "renard", "brun"]`. Permet de rechercher "renard". Utilis√© pour les descriptions, le message des logs.</li>
                            <li><strong>`keyword` :</strong> Le champ **n'est pas analys√©**. "Le renard brun" est stock√© comme une seule valeur. Utilis√© pour les codes HTTP (`response: 200`), les IPs, les statuts.</li>
                        </ul>
                    </div>

                    <!-- AJOUT : Th√©orie des Analyzers -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8"> Les "Analyzers"</h3>
                    <div class="focus-box">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Comment fonctionne l'analyse d'un champ `text` ?</h3>
                        <p class="text-slate-700">Un **Analyzer** est un m√©canisme qui s'ex√©cute *au moment de l'indexation* (√©criture) pour transformer un texte en *tokens* (termes) qui seront plac√©s dans l'index invers√©.</p>
                        <p class="text-slate-700 mt-2">Un Analyzer standard effectue 3 √©tapes :</p>
                        <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-2">
                            <li><strong>Character Filters :</strong> Nettoie le texte (ex: enl√®ve le HTML).</li>
                            <li><strong>Tokenizer :</strong> D√©coupe la cha√Æne en tokens (ex: aux espaces).</li>
                            <li><strong>Token Filters :</strong> Transforme les tokens (ex: met tout en minuscule, enl√®ve les "stop words" comme 'le', 'la', 'un').</li>
                        </ol>
                        <p class="text-slate-700 mt-4 font-semibold">Exemple (Analyzer `standard`) :</p>
                        <ul class="list-disc list-inside text-slate-700">
                            <li>**Texte d'entr√©e :** `"Le renard brun SAUTE."`</li>
                            <li>**Tokens apr√®s `standard_tokenizer` :** `[Le, renard, brun, SAUTE]`</li>
                            <li>**Tokens apr√®s `lowercase_filter` :** `[le, renard, brun, saute]`</li>
                            <li>**Tokens apr√®s `stop_filter` (fran√ßais) :** `[renard, brun, saute]`</li>
                            <li>**R√©sultat dans l'index :** `renard`, `brun`, `saute`.</li>
                        </ul>
                        <p class="text-slate-700 mt-2">C'est gr√¢ce √† cela qu'une recherche pour "renard" trouvera ce document.</p>
                    </div>
                    <!-- FIN AJOUT -->

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Scalabilit√© : Shards & Replicas</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600 mt-2">
                        <li><strong>Shards (Fragments) :</strong> ES divise votre index en morceaux. Cela permet le **scaling horizontal**.</li>
                        <li><strong>Replicas (R√©pliques) :</strong> ES cr√©e des copies de vos shards. Si un n≈ìud tombe en panne, la r√©plique prend le relais. Cela garantit la **haute disponibilit√©**.</li>
                    </ul>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Exemple: Cluster √† 3 N≈ìuds</h4>
                    <p class="text-slate-700 mb-2">Index `logs` (3 shards [P], 1 r√©plique [R]).</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="node-box"><h5 class="font-bold">N≈ìud 1</h5><div class="shard-box shard-p">P0</div><div class="shard-box shard-r">R1</div></div>
                        <div class="node-box"><h5 class="font-bold">N≈ìud 2</h5><div class="shard-box shard-p">P1</div><div class="shard-box shard-r">R2</div></div>
                        <div class="node-box"><h5 class="font-bold">N≈ìud 3</h5><div class="shard-box shard-p">P2</div><div class="shard-box shard-r">R0</div></div>
                    </div>
                    <p class="text-slate-600 mt-4 text-sm">Si le **N≈ìud 2 tombe en panne**, R1 (sur N≈ìud 1) est promu en P1. L'index reste 100% fonctionnel.</p>
                
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Pratique : L'API via les "Dev Tools"</h3>
                    <p class="text-slate-700 mb-4">La seule fa√ßon de parler √† Elasticsearch est via son API REST (en JSON). Kibana fournit un outil "Dev Tools" pour le faire facilement.</p>
                    
                    <!-- IMAGE INT√âGR√âE : dev-tools-kibana-communicate-with-elasticsearch.jpg -->
                    <img src="images/dev-tools-kibana-communicate-with-elasticsearch.jpg" alt="Exemple de commande GET / dans les Dev Tools de Kibana" class="course-image">

                    <p class="text-slate-700">Testez ces commandes de base :</p>
                    <div class="code-block">
<pre><code class="language-json"># 1. Cr√©er (ou mettre √† jour) un document
POST /mon-premier-index/_doc/1
{
  "user": "alex",
  "message": "Ceci est mon premier document!"
}

# 2. R√©cup√©rer ce document
GET /mon-premier-index/_doc/1

# 3. Rechercher dans l'index (via Query DSL)
GET /mon-premier-index/_search
{
  "query": {
    "match": {
      "message": "document"
    }
  }
}
</code></pre>
                    </div>
                </section>
                
                <!-- 4. ES - Installation & Admin -->
                <section id="installation" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">4. Installation & Administration</h1>
                    <p class="text-lg text-slate-600">Mettons en place notre environnement de travail (sur Debian/Ubuntu).</p>

                    <!-- SECTION 4.0 - TP D√âBUTANT APACHE (mise √† jour) -->
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-8">4.0. TP : Notre Premier Serveur (Apache)</h2>
                    <p class="text-slate-700 mb-4">Avant d'analyser des logs, nous avons besoin de quelque chose qui en produit ! Apache est un serveur web qui g√©n√®re un log √† chaque visite.</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 1 : Installation d'Apache</h4>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt update
sudo apt install apache2 -y
</code></pre>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 2 : D√©marrage du Service</h4>
                    <p class="text-slate-700">Un "service" est un programme qui tourne en arri√®re-plan. Nous d√©marrons Apache :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo systemctl start apache2
sudo systemctl enable apache2  # Pour qu'il d√©marre automatiquement
</code></pre>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 3 : V√©rification (La Premi√®re Victoire !)</h4>
                    <p class="text-slate-700">Ouvrez le navigateur de votre machine **h√¥te** (Chrome, Firefox...) et visitez `http://[IP_DE_LA_VM]`. Vous devriez voir la page par d√©faut "Apache2 Ubuntu Default Page".</p>

                    <div class="tip-box">
                        <h3 class="text-xl font-semibold text-violet-900 mb-2">üßòD√©tendez-vous : C'est normal de paniquer</h3>
                        <p class="text-slate-700">Si √ßa ne marche pas (ex: "Connexion refus√©e"), 99% des erreurs sont simples :</p>
                         <ul class="list-disc list-inside space-y-1 text-slate-700 text-sm mt-2">
                             <li>L'IP de la VM est-elle la bonne ? (`ip addr show`)</li>
                             <li>Le service tourne-t-il ? (`sudo systemctl status apache2`)</li>
                             <li>La configuration r√©seau de la VM est-elle bien en "Acc√®s par pont" ? (Voir Chap 0.6)</li>
                         </ul>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 4 : Cr√©er notre propre page</h4>
                    <p class="text-slate-700">La page que vous voyez se trouve dans `/var/www/html/`. Cr√©ons la n√¥tre :</p>
                    <div class="code-block">
<pre><code class="language-bash"># Cr√©e un nouveau fichier 'hello.html' avec ce contenu
echo "<h1>Bonjour le cours Elastic !</h1>" | sudo tee /var/www/html/hello.html
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-2">Maintenant, visitez `http://[IP_DE_LA_VM]/hello.html`. Vous devriez voir votre message !</p>

                    <!-- SECTION - TP "√Ä L'ANCIENNE" (mise √† jour) -->
                    <h2 class="text-2xl font-semibold text-sky-900 mt-12">üõ†Ô∏è Activit√© : D√©couvrir les logs "√† l'ancienne" (avant ELK)</h2>
                    <p class="text-slate-700">Chaque fois que vous avez visit√© ces pages, Apache a √©crit une ligne dans un fichier. C'est √ßa, un log !</p>

                    <div class="focus-box border-l-blue-400 mt-4">
                        <h4 class="font-semibold text-blue-900 mb-2">1. Voir les logs en temps r√©el</h4>
                        <p class="text-slate-700">Dans votre terminal SSH, lancez cette commande. Elle "surveille" le fichier :</p>
                        <div class="code-block"><pre><code>sudo tail -f /var/log/apache2/access.log</code></pre></div>
                        <p class="text-slate-700 mt-2">Maintenant, depuis votre navigateur, **rafra√Æchissez la page `hello.html` plusieurs fois**. Vous verrez les lignes appara√Ætre instantan√©ment dans votre terminal !</p>
                    </div>

                    <div class="focus-box border-l-lime-400 mt-6">
                        <h4 class="font-semibold text-lime-900 mb-2">2. G√©n√©rer une erreur 404</h4>
                        <p class="text-slate-700">Visitez une page qui n'existe pas : `http://[IP_DE_LA_VM]/page-cass√©e`.</p>
                        <p class="text-slate-700 mt-2">Regardez votre `tail -f`. Vous verrez une ligne avec un code "404".</Details>
                    </div>
                    
                    <div class="focus-box border-l-cyan-400 mt-6">
                        <h4 class="font-semibold text-cyan-900 mb-2">3. Filtrer les logs avec `grep`</h4>
                        <p class="text-slate-700">(Arr√™tez `tail -f` avec Ctrl+C). Cherchons toutes les erreurs 404 :</p>
                        <div class="code-block"><pre><code>grep " 404 " /var/log/apache2/access.log</code></pre></div>
                        <p class="text-slate-700 mt-2">Et si on veut le top 3 des IPs qui visitent notre site ?</p>
                        <div class="code-block"><pre><code>awk '{print $1}' /var/log/apache2/access.log | sort | uniq -c | sort -nr | head -3</code></pre></div>
                    </div>

                    <div class="focus-box border-l-yellow-400 mt-6">
                        <h4 class="font-semibold text-yellow-900 mb-2">4. Les Limites de l'Approche Manuelle</h4>
                        <p class="text-slate-700">C'est puissant, mais imaginez faire √ßa sur 100 serveurs, ou chercher "toutes les erreurs 404, sauf celles de l'IP 1.2.3.4, entre 14h et 16h, sur les 3 derniers jours". C'est impossible.</p>
                        <p class="text-slate-700 mt-2 font-bold">‚ûî C'est le probl√®me qu'Elastic Stack vient r√©soudre.</p>
                    </div>
                    
                    <!-- FIN DE L'AJOUT - D√âBUT DE L'INSTALLATION ES -->
                    
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.1. Installation d'Elasticsearch (v8.x)</h2>
                    <p class="text-slate-700">Maintenant, installons le "cerveau" qui va stocker et analyser ces logs.</p>
                    <div class="code-block">
<pre><code class="language-bash"># 1. Ajouter la cl√© GPG d'Elastic
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg
# 2. Ajouter le d√©p√¥t
echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list
# 3. Installer Elasticsearch
sudo apt-get update && sudo apt-get install elasticsearch
</code></pre>
                    </div>
                    
                    <p class="text-slate-700 font-semibold mt-4">Configuration pour la VM :</p>
                    <p class="text-slate-700">Pour qu'Elasticsearch soit accessible depuis votre machine h√¥te, modifiez `/etc/elasticsearch/elasticsearch.yml` (`sudo nano ...`) et d√©commentez/ajoutez :</p>
                    <div class="code-block"><pre><code>network.host: 0.0.0.0</code></pre></div>

                    <p class="text-slate-700 mt-4">D√©marrez le service et r√©initialisez le mot de passe :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo systemctl start elasticsearch
sudo systemctl enable elasticsearch
# Attendez 1-2 minutes...
sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
</code></pre>
                    </div>
                    <p class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-lg mt-4"><strong>Important :</strong> Notez pr√©cieusement le mot de passe g√©n√©r√© !</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">V√©rifications (Elasticsearch)</h4>
                    <div class="code-block">
<pre><code class="language-bash"># Test de base (DANS la VM)
curl --insecure -u elastic:&lt;votre_mot_de_passe&gt; https://localhost:9200
# Erreur courante : vm.max_map_count
# Solution :
sudo sysctl -w vm.max_map_count=262144
echo 'vm.max_map_count=262144' | sudo tee -a /etc/sysctl.conf
</code></pre>
                    </div>

                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.2. Installation de Kibana (v8.x)</h2>
                    <div class="code-block">
<pre><code class="language-bash">sudo apt-get install kibana
</code></pre>
                    </div>
                    
                    <p class="text-slate-700 font-semibold mt-4">Configuration pour la VM :</p>
                    <p class="text-slate-700">Pour que Kibana soit accessible depuis votre navigateur h√¥te, modifiez `/etc/kibana/kibana.yml` (`sudo nano ...`) et d√©commentez/ajoutez :</p>
                    <div class="code-block"><pre><code>server.host: "0.0.0.0"</code></pre></div>
                    <p class="text-slate-700 mt-2">Assurez-vous aussi que l'URL d'Elasticsearch est `https://localhost:9200`.</p>
                    
                    <p class="mt-4">Cr√©ez un token d'enr√¥lement pour Kibana :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
</code></pre>
                    </div>
                    <p class="mt-4">Copiez le token. D√©marrez Kibana :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo systemctl start kibana
sudo systemctl enable kibana
</code></pre>
                    </div>
                    <p class="mt-4">Acc√©dez √† `http://[IP_DE_LA_VM]:5601` depuis votre navigateur **h√¥te**. Collez le token, puis connectez-vous avec `elastic` et votre mot de passe.</p>

                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 mt-12">4.3. Checkpoint : Test de la Stack Compl√®te</h2>
                    <div class="focus-box border-l-green-500">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Objectif de Validation</h3>
                        <p class="text-slate-700 mb-4">Utilisons les **Dev Tools** de Kibana pour ins√©rer manuellement un document.</p>
                        <ol class="list-decimal list-inside space-y-2 text-slate-700">
                            <li>Ouvrez Kibana (`http://[IP_DE_LA_VM]:5601`).</li>
                            <li>Cliquez sur le menu ‚ò∞ en haut √† gauche.</li>
                            <li>Descendez tout en bas, dans la section "Management", cliquez sur **"Dev Tools"**.</li>
                        </ol>
                        
                        <!-- IMAGE INT√âGR√âE : dev-tools-kibana-for-elasticsearch.jpg -->
                        <img src="images/dev-tools-kibana-for-elasticsearch.jpg" alt="O√π trouver les Dev Tools dans le menu Kibana" class="course-image">

                        <p class="text-slate-700 mt-2">4. Dans la console de gauche, tapez cette commande et cliquez sur le bouton "Play" (triangle) :</p>
                        <div class="code-block mt-4">
<pre><code class="language-json">POST /test-index/_doc/1
{ "message": "Ma stack Elastic fonctionne !" }
</code></pre>
                        </div>
                        <p class="text-slate-700 mt-4"><strong>R√©sultat attendu :</strong> Vous devriez voir `"created": true` dans la fen√™tre de droite. F√©licitations !</p>
                    </div>
                </section>
                
                <!-- 5. Logstash -->
                <section id="logstash" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">5. Logstash - Le Pipeline de Donn√©es</h1>
                    <p class="text-lg text-slate-600">Logstash est le "couteau suisse" de l'ingestion. Il re√ßoit, transforme et envoie les donn√©es.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.1. Th√©orie : Le Pipeline Logstash (Input, Filter, Output)</h3>
                    <div class="flex flex-col md:flex-row justify-between items-center text-center space-y-4 md:space-y-0">
                        <div class="p-4 bg-sky-50 rounded-lg w-full md:w-1/3"><div class="text-5xl">üì•</div><h4 class="font-semibold text-sky-800 text-lg">1. Input</h4><p class="text-sm text-slate-600">La source (ex: `file`, `beats`).</p></div>
                        <div class="diagram-arrow">‚Üí</div>
                        <div class="p-4 bg-green-50 rounded-lg w-full md:w-1/3"><div class="text-5xl">‚öôÔ∏è</div><h4 class="font-semibold text-green-800 text-lg">2. Filter</h4><p class="text-sm text-slate-600">Transformer (ex: `grok`, `mutate`).</p></div>
                        <div class="diagram-arrow">‚Üí</div>
                        <div class="p-4 bg-indigo-50 rounded-lg w-full md:w-1/3"><div class="text-5xl">üì§</div><h4 class="font-semibold text-indigo-800 text-lg">3. Output</h4><p class="text-sm text-slate-600">La destination (ex: `elasticsearch`).</p></div>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.2. Th√©orie : Comprendre le Filtre "Grok"</h3>
                    <p class="text-slate-700 mb-4">Grok extrait des champs structur√©s √† partir d'un message de log non structur√©.</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 1 : Log simple</h4>
                    <p class="text-slate-700">Log : <code class="text-sm">"127.0.0.1 GET 200"</code> | Pattern : <code class="text-sm">"%{IP:client_ip} %{WORD:methode} %{NUMBER:code_http}"</code></p>
                    <p class="text-slate-700">R√©sultat : `{ "client_ip": "127.0.0.1", "methode": "GET", ... }`</p>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 2 : Le pattern `%{COMBINEDAPACHELOG}`</h4>
                    <p class="text-slate-700">Pour notre log Apache, Logstash fournit un pattern pr√©-d√©fini, `%{COMBINEDAPACHELOG}`, qui d√©compose tout automatiquement.</p>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 3 : D√©bogage Grok</h4>
                    <p class="text-slate-700">Utilisez le **Grok Debugger** (dans Kibana > Dev Tools) pour tester vos patterns en direct.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">5.3. Pratique : Ingestion des Logs Apache</h3>
                    <p>Installez Logstash (`sudo apt-get install logstash`) et cr√©ez le fichier `/etc/logstash/conf.d/01-apache.conf` :</p>
                    <div class="code-block">
<pre><code class="language-conf">input {
    file {
        path => "/var/log/apache2/access.log"
        start_position => "beginning"
        sincedb_path => "/dev/null" # Pour les tests
    }
}
filter {
    grok {
        match => { "message" => "%{COMBINEDAPACHELOG}" }
    }
    date {
        match => [ "timestamp" , "dd/MMM/yyyy:HH:mm:ss Z" ]
    }
    mutate {
        convert => { "response" => "integer", "bytes" => "integer" }
    }
}
output {
    elasticsearch {
         hosts => ["https://localhost:9200"] 
         index => "apache-logstash-%{+YYYY.MM.dd}"
         user => "elastic"
         password => "<VOTRE_MOT_DE_PASSE_ELASTIC>"
         ssl_verification_mode => "none"
    }
    stdout { codec => rubydebug }
}
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">D√©marrage et Test (Logstash)</h4>
                    <p class="text-slate-700">**Toujours tester la configuration** avant de d√©marrer :</p>
                    <div class="code-block">
<pre><code class="language-bash"># Test de syntaxe
sudo -u logstash /usr/share/logstash/bin/logstash --path.settings /etc/logstash -t -f /etc/logstash/conf.d/01-apache.conf
# Doit retourner "Configuration OK"
</code></pre>
                    </div>
                    <p class="text-slate-700 mt-4">D√©marrez Logstash et donnez-lui la permission de lire les logs :</p>
                    <div class="code-block">
<pre><code class="language-bash">sudo usermod -aG adm logstash
sudo systemctl restart logstash
sudo systemctl enable logstash
</code></pre>
                    </div>
                    
                    <div class="challenge-box">
                         <h3 class="text-xl font-semibold text-yellow-900 mb-2">‚ö°Ô∏è D√©fi : Provoquer une Erreur Grok</h3>
                         <ol class="list-decimal list-inside space-y-2 text-slate-700 text-sm">
                             <li>Ouvrez votre fichier `01-apache.conf`.</li>
                             <li>Modifiez le filtre grok en `match => { "message" => "%{WORD}" }` (un pattern volontairement faux).</li>
                             <li>Red√©marrez Logstash : `sudo systemctl restart logstash`.</li>
                             <li>G√©n√©rez un nouveau log Apache : `curl http://localhost/test-erreur-grok`.</li>
                             <li>Allez dans Kibana > Discover (index `apache-logstash-*`).</li>
                             <li>**Trouvez le nouveau log.** Vous verrez qu'il n'a pas les champs `clientip`, `response`, etc. √Ä la place, il a un champ `tags` avec la valeur `_grokparsefailure`.</li>
                             <li>Remettez le bon pattern (`%{COMBINEDAPACHELOG}`) et red√©marrez Logstash.</li>
                         </ol>
                    </div>

                    <div class="focus-box border-l-green-500 mt-6">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Chapitre 5</h3>
                        <p class="text-slate-700 mb-4">G√©n√©rez du trafic Apache (`curl http://localhost/page-test` dans la VM), puis allez dans Kibana (`http://[IP_DE_LA_VM]:5601`) -> Menu ‚ò∞ -> Stack Management -> Index Patterns -> "Create index pattern".</p>
                        <p class="text-slate-700 mb-4">Cr√©ez un pattern `apache-logstash-*`.</p>
                        
                        <!-- IMAGE INT√âGR√âE : define-pattern-index.jpg -->
                        <img src="images/define-pattern-index.jpg" alt="Cr√©ation d'un index pattern apache-*" class="course-image">
                        
                        <p class="text-slate-700 mb-4">Ensuite, allez dans **Discover** :</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>Vous devriez voir vos logs appara√Ætre.</li>
                            <li><strong>Validation :</strong> Si vous ne voyez PAS un champ `tags` avec la valeur `_grokparsefailure`, votre parsing a r√©ussi !</li>
                        </ul>
                    </div>
                </section>
                
                <!-- 6. La Famille Beats -->
                <section id="beats" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">6. La Famille Beats</h1>
                    <p class="text-lg text-slate-600">Logstash est lourd. Pour la simple collecte, les Beats (√©crits en Go) sont plus l√©gers.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.1. Mini-TP : Filebeat et la Magie des Modules</h3>
                    <p class="text-slate-700">**R√¥le :** L'agent l√©ger pour collecter les fichiers de logs.</p>
                    <p class="text-slate-700 mt-2">**Concept Cl√© : Les Modules.** Un module est une configuration "tout-en-un" qui inclut le parsing (c√¥t√© ES) et les dashboards Kibana. Nous allons l'utiliser pour Apache.</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 1 : Arr√™ter Logstash</h4>
                    <p class="text-slate-700">Nous allons remplacer Logstash par Filebeat pour ce test. √âvitons les doublons.</p>
                    <div class="code-block"><pre><code>sudo systemctl stop logstash</code></pre></div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 2 : Installer et Configurer Filebeat</h4>
                    <div class="code-block">
<pre><code class="language-bash"># 1. Installer
sudo apt-get install filebeat

# 2. Configurer la connexion (modifier /etc/filebeat/filebeat.yml)
# Commentez output.logstash
# D√©commentez output.elasticsearch et mettez vos infos:
# output.elasticsearch:
#   hosts: ["https://localhost:9200"]
#   username: "elastic"
#   password: "<VOTRE_MOT_DE_PASSE_ELASTIC>"
#   ssl.verification_mode: "none"
# D√©commentez setup.kibana et mettez vos infos:
# setup.kibana:
#   host: "http://localhost:5601"
#   username: "elastic"
#   password: "<VOTRE_MOT_DE_PASSE_ELASTIC>"
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 3 : Activer le Module et D√©marrer</h4>
                    <div class="code-block">
<pre><code class="language-bash"># 1. Activer le module
sudo filebeat modules enable apache

# 2. Charger les dashboards et pipelines (une seule fois)
sudo filebeat setup -e

# 3. D√©marrer
sudo systemctl start filebeat
sudo systemctl enable filebeat
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">√âtape 4 : Voir la Magie (R√©sultat)</h4>
                    <p class="text-slate-700">G√©n√©rez √† nouveau du trafic Apache (`curl http://localhost/filebeat-test`). Allez dans Kibana :</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li>**Discover :** Cr√©ez l'index pattern `filebeat-*`. Vous voyez vos logs, d√©j√† pars√©s !</li>
                        <li>**Dashboards :** Allez dans Menu ‚ò∞ -> Dashboard et cherchez "apache".</li>
                    </ul>
                    <!-- IMAGE INT√âGR√âE : apache2-module-filebeat-kibana-dashboard-choice.jpg -->
                    <img src="images/apache2-module-filebeat-kibana-dashboard-choice.jpg" alt="Choix du dashboard Apache pr√©-construit" class="course-image">
                    <p class="text-slate-700">Ouvrez le dashboard "[Filebeat Apache] Access and error logs". Vous avez un dashboard complet, cr√©√© en quelques commandes !</p>
                    <!-- IMAGE INT√âGR√âE : apache2-module-filebeat-kibana-dashboard.jpg -->
                    <img src="images/apache2-module-filebeat-kibana-dashboard.jpg" alt="Dashboard Apache Filebeat" class="course-image">

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.2. Metricbeat (Collecteur de m√©triques)</h3>
                    <p class="text-slate-700">**R√¥le :** Collecte les m√©triques (CPU, RAM, Disque, R√©seau...) et les m√©triques de services (Apache, MySQL...).</p>
                    <div class="focus-box">
                        <h3 class="text-xl font-semibold text-sky-900 mb-4">Focus : M√©triques vs Logs</h3>
                        <ul class="space-y-3 mt-4">
                            <li class="flex items-start"><span class="text-2xl mr-3">üßæ</span><div><h4 class="font-semibold text-slate-800">Logs (Filebeat)</h4><p class="text-slate-600 text-sm">Un **√©v√©nement discret**. (Ex: "Utilisateur connect√©").</p></div></li>
                            <li class="flex items-start"><span class="text-2xl mr-3">üå°Ô∏è</span><div><h4 class="font-semibold text-slate-800">M√©triques (Metricbeat)</h4><p class="text-slate-600 text-sm">Une **mesure num√©rique** √† un instant T. (Ex: "CPU √† 35%").</p></div></li>
                        </ul>
                    </div>
                    
                    <div class="challenge-box">
                         <h3 class="text-xl font-semibold text-yellow-900 mb-2">‚ö°Ô∏è D√©fi Chrono : Vos M√©triques Syst√®me en 5 min</h3>
                         <p class="text-slate-700 mb-2">Voyons √† quel point les modules sont rapides.</p>
                         <ol class="list-decimal list-inside space-y-2 text-slate-700 text-sm">
                             <li>Installez Metricbeat : `sudo apt-get install metricbeat`.</li>
                             <li>Configurez la connexion (`/etc/metricbeat/metricbeat.yml`) comme vous l'avez fait pour Filebeat.</li>
                             <li>Activez le module `system` : `sudo metricbeat modules enable system`.</li>
                             <li>Lancez le setup : `sudo metricbeat setup -e`.</li>
                             <li>D√©marrez le service : `sudo systemctl start metricbeat`.</li>
                             <li>Allez dans Kibana > Dashboards et ouvrez le dashboard **"[Metricbeat System] Host overview"**.</li>
                             <li>**Objectif :** Avez-vous r√©ussi en moins de 5 minutes ? Vous voyez maintenant le CPU et la RAM de votre VM en temps r√©el.</li>
                         </ol>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.3. Autres Beats Essentiels</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Packetbeat :</strong> Analyse le trafic r√©seau.</li>
                        <li><strong>Heartbeat :</strong> Monitoring de disponibilit√© (Uptime).</li>
                        <li><strong>Auditbeat :</strong> Audit de s√©curit√© (int√©grit√© des fichiers).</li>
                        <li><strong>Winlogbeat :</strong> Collecte les journaux d'√©v√©nements Windows.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.4. Comparaison : Logstash vs Filebeat</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <h4 class="font-semibold text-lg text-green-700">Filebeat (Agent L√©ger / "Shipper")</h4>
                            <ul class="list-disc list-inside text-sm text-slate-600 mt-2 space-y-1">
                                <li>√âcrit en Go : **Tr√®s l√©ger**.</li>
                                <li>S'installe sur **chaque** serveur.</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <h4 class="font-semibold text-lg text-orange-700">Logstash (Processeur Lourd / "Processor")</h4>
                            <ul class="list-disc list-inside text-sm text-slate-600 mt-2 space-y-1">
                                <li>√âcrit en Java : **Lourd**.</li>
                                <li>S'installe sur un **serveur central**.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">6.5. Comparaison : Quel Beat choisir ?</h3>
                    <table class="w-full border border-slate-300 text-left text-sm">
                        <thead class="bg-slate-100"><tr><th class="p-2 border-r">Beat</th><th class="p-2">Question √† laquelle il r√©pond</th></tr></thead>
                        <tbody>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Filebeat</td><td class="p-2">"Qu'est-il arriv√© ?" (ex: Erreur 404)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Metricbeat</td><td class="p-2">"Comment va le syst√®me ?" (ex: CPU √† 80%)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Packetbeat</td><td class="p-2">"Combien de temps a pris la requ√™te ?" (ex: 120ms)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Heartbeat</td><td class="p-2">"Le service est-il en ligne ?" (ex: Down)</td></tr>
                            <tr class="border-b"><td class="p-2 border-r font-semibold">Auditbeat</td><td class="p-2">"Qui a modifi√© ce fichier ?" (ex: 'root')</td></tr>
                        </tbody>
                    </table>

                    <div class="focus-box border-l-green-500 mt-6">
                        <h3 class="text-xl font-semibold text-green-900 mb-4">‚úÖ Checkpoint Chapitre 6</h3>
                        <p class="text-slate-700 mb-4">√Ä ce stade, vous devriez avoir plusieurs index patterns dans Kibana (Stack Management -> Index Patterns) : `apache-logstash-*` (si vous avez red√©marr√© Logstash), `filebeat-*` et `metricbeat-*` (si vous avez fait le d√©fi).</p>
                    </div>
                </section>
                
                <!-- 7. Kibana -->
                <section id="kibana" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">7. Kibana - Visualisation et Dashboards</h1>
                    <p class="text-lg text-slate-600">Apprenons √† explorer nos donn√©es.</p>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Th√©orie : Les 4 Piliers de Kibana</h3>
                    <ul class="list-decimal list-inside space-y-2 text-slate-600 mt-2">
                        <li><strong>Discover :</strong> L'outil de recherche (le "Google" de vos logs).</li>
                        <li><strong>Visualize :</strong> L'outil pour cr√©er un graphique.</li>
                        <li><strong>Dashboard :</strong> Une collection de plusieurs visualisations.</li>
                        <li><strong>Dev Tools :</strong> La console pour parler √† l'API d'Elasticsearch.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.0. Th√©orie : Index Patterns & Donn√©es Temporelles</h3>
                    <div class="focus-box">
                        <h4 class="text-lg font-semibold text-slate-800">Index Patterns</h4>
                        <p class="text-slate-700 mb-2">C'est la fa√ßon dont Kibana "sait" quels index interroger (ex: `apache-logstash-*` ou `metricbeat-*`). C'est la premi√®re chose √† cr√©er.</p>
                        <!-- IMAGE INT√âGR√âE : create-pattern-index.jpg -->
                        <img src="images/create-pattern-index.jpg" alt="√âcran de cr√©ation des Index Patterns dans Kibana" class="course-image">

                        <h4 class="text-lg font-semibold text-slate-800 mt-4">Donn√©es Temporelles (Time Picker)</h4>
                        <p class="text-slate-700 mb-2">En haut √† droite de Kibana, le **Time Picker** vous permet de filtrer la p√©riode (ex: "Last 15 minutes", "Today").</p>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.1. Pratique : Discover (Explorer)</h3>
                    <p class="text-slate-700">C'est votre loupe pour chercher dans les logs.</p>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4">
                        <li>Cliquez sur le menu ‚ò∞ en haut √† gauche.</li>
                        <li>Dans "Analytics", cliquez sur **Discover**.</li>
                        <li>En haut √† gauche, sous "Discover", s√©lectionnez votre index pattern `filebeat-*`.</li>
                    </ol>
                    <!-- IMAGE INT√âGR√âE : apache2-module-filebeat-kibana-discover-logs.jpg -->
                    <img src="images/apache2-module-filebeat-kibana-discover-logs.jpg" alt="Vue Discover de Kibana" class="course-image">
                    <p class="text-slate-700 mt-4">La barre de recherche utilise le **KQL (Kibana Query Language)**. Essayez :</p>
                    <div class="code-block">
<pre><code># Trouver toutes les erreurs 404 (pour le module Filebeat Apache)
http.response.status_code: 404
</code></pre>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">7.2. Pratique : Cr√©er des Visualisations</h3>
                    <p class="text-slate-700">Cr√©ons deux visualisations pour un dashboard personnalis√© (avec l'index `filebeat-*`).</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-4">Visualisation 1 : Volume de Donn√©es (Line Chart)</h4>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4">
                        <li>Menu ‚ò∞ -> **Visualize Library** -> "Create visualization".</li>
                        <li>Choisissez "Line" (Ligne).</li>
                        <li>S√©lectionnez votre source de donn√©es `filebeat-*`.</li>
                        <li><strong>Axe Y (Metrics) :</strong>
                            <ul class="list-disc list-inside ml-6 text-sm">
                                <li>Agr√©gation : "Average" (Moyenne)</li>
                                <li>Champ : `http.response.body.bytes`</li>
                            </ul>
                        </li>
                    </ol>
                    <!-- IMAGE INT√âGR√âE : apache-kibana-bytes-y-axis.jpg -->
                    <img src="images/apache-kibana-bytes-y-axis.jpg" alt="Configuration de l'axe Y (Moyenne des bytes)" class="course-image">

                    <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4" start="5">
                        <li><strong>Axe X (Buckets) :</strong>
                            <ul class="list-disc list-inside ml-6 text-sm">
                                <li>Agr√©gation : "Date Histogram" (Histogramme de date)</li>
                                <li>Champ : `@timestamp`</li>
                            </ul>
                        </li>
                    </ol>
                    <!-- IMAGE INT√âGR√âE : apache-kibana-bytes-x-axis.jpg -->
                    <img src="images/apache-kibana-bytes-x-axis.jpg" alt="Configuration de l'axe X (Date Histogram)" class="course-image">
                    <p class="text-slate-700 mt-2">Cliquez "Update". Vous avez un graphique montrant l'√©volution de la taille moyenne des r√©ponses. Sauvegardez-le ("Taille Moyenne des Requ√™tes").</p>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">Visualisation 2 : Visiteurs Uniques (Metric)</h4>
                     <ol class="list-decimal list-inside space-y-2 text-slate-700 mt-4">
                        <li>Cr√©ez une nouvelle visualisation, type "Metric".</li>
                        <li>S√©lectionnez votre source de donn√©es `filebeat-*`.</li>
                        <li><strong>Metrics :</strong>
                            <ul class="list-disc list-inside ml-6 text-sm">
                                <li>Agr√©gation : "Unique Count" (Compte unique)</li>
                                <li>Champ : `client.ip.keyword`</li>
                                <li>Label : "Visiteurs Uniques"</li>
                            </ul>
                        </li>
                    </ol>
                    <!-- IMAGE INT√âGR√âE : apache-kibana-uniq-user.jpg -->
                    <img src="images/apache-kibana-uniq-user.jpg" alt="Configuration d'une m√©trique 'Visiteurs Uniques'" class="course-image">
                    <p class="text-slate-700 mt-2">Sauvegardez-le ("Visiteurs Uniques").</de>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 3 : Le Dashboard</h4>
                    <p class="text-slate-700 mt-2">Allez dans Menu ‚ò∞ -> **Dashboard** -> "Create dashboard". Cliquez "Add from library" et ajoutez vos deux nouvelles visualisations. R√©organisez-les. Vous avez cr√©√© un dashboard personnalis√© !</p>
                    
                    <div class="challenge-box">
                         <h3 class="text-xl font-semibold text-yellow-900 mb-2">‚ö°Ô∏è D√©fi : Trouver les Requ√™tes Suspectes</h3>
                         <p class="text-slate-700 mb-2">Votre dashboard est bien, mais inutile s'il ne r√©pond pas √† une question.</p>
                         <ol class="list-decimal list-inside space-y-2 text-slate-700 text-sm">
                             <li>Retournez sur votre dashboard.</li>
                             <li>Dans la barre de recherche (KQL) en haut, tapez `http.response.status_code: 404`.</li>
                             <li>Vos deux visualisations se mettent √† jour automatiquement pour ne montrer que les donn√©es relatives aux erreurs 404.</li>
                             <li>**Bonus :** Cr√©ez une troisi√®me visualisation "Pie" (Camembert) qui montre la r√©partition (`Terms`) des `http.response.status_code.keyword` (Codes de r√©ponse).</li>
                         </ol>
                    </div>
                </section>
                
                <!-- 8. Cas Pratiques -->
                <!-- MISE √Ä JOUR : Remplacement du projet "V√©los" par le projet "Air & Trafic" -->
<section id="cas-pratiques" class="content-section space-y-6 hidden">
    <h1 class="text-4xl font-bold tracking-tight text-slate-900">8. Cas Pratique : Smart City - Qualit√© de l‚ÄôAir & Trafic Routier</h1>
    <p class="text-lg text-slate-600">Un projet complet, simple et concret pour analyser la pollution et le trafic routier √† Paris √† partir de donn√©es Open Data, en utilisant Python pour l‚Äôingestion.</p>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Objectif : Dashboard "Air & Trafic Paris"</h3>
    <p class="text-slate-700"><strong>But :</strong> Cr√©er un tableau de bord croisant les donn√©es de pollution et de trafic routier √† Paris pour r√©pondre √† ces questions :</p>
    <ul class="list-disc list-inside space-y-2 text-slate-600">
        <li>Quels sont les quartiers les plus pollu√©s ?</li>
        <li>Existe-t-il une corr√©lation entre la densit√© du trafic et la pollution ?</li>
        <li>√Ä quelles heures observe-t-on les pics de pollution ?</li>
    </ul>

    <div class="focus-box border-l-green-500 mt-4">
        <h3 class="text-xl font-semibold text-green-900 mb-4">√âtape 1 : T√©l√©charger le CSV l√©ger</h3>
        <p class="text-slate-700 mb-2">Pour simplifier le TP et permettre une ingestion rapide, nous allons utiliser un fichier CSV pr√©par√© (~50 lignes) contenant les donn√©es de trafic :</p>
        <ul class="list-disc list-inside text-slate-700 text-sm">
            <li><a href="https://raw.githubusercontent.com/massynas/elastic_stack/refs/heads/main/traffic_light.csv" target="_blank" class="text-sky-600 underline">T√©l√©charger le CSV de trafic l√©ger</a></li>
        </ul>
        <p class="text-slate-700 mt-2 mb-2">Placez le fichier dans un dossier accessible sur votre machine, par exemple <code>C:\TP\smartcity\</code>.</p>
    </div>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">√âtape 2 : Installer Python et les librairies</h3>
    <div class="focus-box border-l-green-500 mt-4">
        <p class="text-slate-700 mb-2">Assurez-vous d‚Äôavoir Python install√© sur votre machine Windows :</p>
        <pre class="code-block text-sm">https://www.python.org/downloads/</pre>
        <p class="text-slate-700 mb-2">Puis installez les librairies n√©cessaires :</p>
        <pre class="code-block text-sm">pip install pandas elasticsearch</pre>
    </div>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">√âtape 3 : Pr√©parer l‚Äôindex Elasticsearch</h3>
    <div class="focus-box border-l-green-500 mt-4">
        <p class="text-slate-700 mb-2">Sur votre VM Elasticsearch, cr√©ez un index avec mapping :</p>
        <pre class="code-block text-sm">
PUT smartcity-light
{
  "mappings": {
    "properties": {
      "@timestamp": { "type": "date" },
      "libelle": { "type": "keyword" },
      "debit": { "type": "integer" },
      "taux_occupation": { "type": "float" },
      "location": { "type": "geo_point" }
    }
  }
}
        </pre>
    </div>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">√âtape 4 : Script Python pour ingestion</h3>
    <div class="focus-box border-l-green-500 mt-4">
        <p class="text-slate-700 mb-2">Cr√©ez un fichier <code>ingest_traffic.py</code> sur votre machine Windows :</p>
        <pre class="code-block text-sm">
import pandas as pd
from elasticsearch import Elasticsearch, helpers

# Connexion √† Elasticsearch distant
es = Elasticsearch(
    "https://192.168.1.22:9200",  # IP de votre VM
    basic_auth=("elastic", "hZqVL2H+MVJhx7h2hpTh"),
    verify_certs=False
)

index_name = "smartcity-light"

# Lire le CSV
df = pd.read_csv("C:\\TP\\smartcity\\traffic_light.csv", sep=";")

docs = []
for _, row in df.iterrows():
    lat, lon = map(float, row["geo_point_2d"].split(","))
    doc = {
        "_index": index_name,
        "_source": {
            "@timestamp": row["horodate"],
            "libelle": row["libelle"],
            "debit": int(row["debit"]),
            "taux_occupation": float(row["taux_occupation"]),
            "location": {"lat": lat, "lon": lon}
        }
    }
    docs.append(doc)

helpers.bulk(es, docs)
print(f"Ingestion termin√©e : {len(docs)} documents index√©s.")
        </pre>
    </div>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">√âtape 5 : Ex√©cuter le script</h3>
    <div class="focus-box border-l-green-500 mt-4">
        <p class="text-slate-700 mb-2">Dans PowerShell ou cmd :</p>
        <pre class="code-block text-sm">python C:\TP\smartcity\ingest_traffic.py</pre>
        <p class="text-slate-700 mt-2">Vous devriez voir : <code>Ingestion termin√©e : 50 documents index√©s.</code></p>
    </div>

    <h3 class="text-2xl font-semibold text-sky-900 mt-8">√âtape 6 : Cr√©er le Dashboard Kibana</h3>
    <div class="focus-box border-l-green-500 mt-4">
        <p class="text-slate-700 mb-2">Cr√©ez l‚ÄôIndex Pattern <code>smartcity-light</code> dans Kibana, puis construisez le Dashboard :</p>
        <ul class="list-disc list-inside space-y-2 text-slate-600">
            <li>
                <strong>Carte du Trafic (Type: Map)</strong>
                <ul class="list-disc list-inside ml-6 text-sm">
                    <li>Champ g√©ospatial : <code>location</code></li>
                    <li>Infobulle : <code>libelle</code>, <code>debit</code>, <code>taux_occupation</code></li>
                </ul>
            </li>
            <li>
                <strong>Graphique Lin√©aire (Type: Line)</strong>
                <ul class="list-disc list-inside ml-6 text-sm">
                    <li>Axe Y : <code>debit</code> ou <code>taux_occupation</code></li>
                    <li>Axe X : <code>@timestamp</code></li>
                </ul>
            </li>
            <li>
                <strong>KPI</strong>
                <ul class="list-disc list-inside ml-6 text-sm">
                    <li>D√©bit moyen total ou taux moyen de congestion</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="share-box mt-4">
        <h3 class="text-xl font-semibold text-sky-900 mb-2">üöÄ Partagez votre Dashboard !</h3>
        <p class="text-slate-700">Prenez une capture d‚Äô√©cran de votre Dashboard final et partagez-la. Vous aurez construit un projet concret et g√©olocalis√© en moins de 30 minutes !</p>
    </div>
</section>

                    <!-- FIN AJOUT -->
<section id="optimisation" class="content-section space-y-6 hidden">
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Th√©orie du Sharding (Routage des Donn√©es)</h3>
                    <p class="text-slate-700">Comment Elasticsearch d√©cide-t-il sur quel shard (P0, P1, ou P2) un nouveau document doit aller ?</p>
                    <p class="text-slate-700 mt-2">Il utilise une formule de hachage simple :</p>
                    <div class="code-block text-center text-base"><pre><code>shard_cible = hash(ID_du_document) % nombre_de_shards_primaires</code></pre></div>
                    <p class="text-slate-700 mt-2">Cela signifie que le choix du shard est **d√©terministe**. Si vous mettez √† jour un document, ES recalcule le hash de son ID et sait exactement sur quel shard le trouver, sans avoir √† chercher.</p>
                    <p class="text-slate-700 mt-2">C'est aussi pour cela qu'il est **impossible de changer le nombre de shards primaires** d'un index existant (car la formule de calcul deviendrait fausse). La seule fa√ßon de le faire est de `_reindex` les donn√©es dans un nouvel index avec le bon nombre de shards.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Troubleshooting : Sant√© du Cluster (Rouge / Jaune / Vert)</h3>
                    <p class="text-slate-700">La commande `GET /_cluster/health` (dans Dev Tools) retourne un statut :</p>
                    <ul class="list-disc list-inside space-y-3 text-slate-700">
                        <li><span class="font-semibold text-green-600">Vert (Green) :</span> Tout va bien.</li>
                        <li><span class="font-semibold text-yellow-600">Jaune (Yellow) :</span> **Probl√®me courant.** Tous les shards principaux sont allou√©s, mais une ou plusieurs **r√©pliques** n'ont pas pu l'√™tre. (Cause : Vous n'avez qu'un seul n≈ìud. C'est normal en dev).</li>
                        <li><span class="font-semibold text-red-600">Rouge (Red) :</span> **Grave.** Un ou plusieurs **shards principaux** sont manquants. Des donn√©es sont perdues.</li>
                    </ul>
                    <div class="code-block mt-2">
<pre><code class="language-json"># Forcer un index √† passer en vert (en dev, si Jaune)
PUT /mon-index-jaune/_settings
{ "index": { "number_of_replicas": 0 } }
</code></pre>
                    </div>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Gestion du Cycle de Vie (ILM)</h3>
                    <p class="text-slate-700">ILM (Index Lifecycle Management) automatise le d√©placement des donn√©es √† travers diff√©rents "tiers" (Hot, Warm, Cold, Frozen) pour √©conomiser de l'argent.</p>
                    <div class="space-y-4 mt-6">
                        <div class="ilm-tier ilm-hot"><h5 class="font-bold text-lg text-red-800">1. Tier HOT (0-7 jours)</h5><p class="text-sm text-slate-700">Ingestion et recherche active (SSDs NVMe).</p></div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier ilm-warm"><h5 class="font-bold text-lg text-orange-800">2. Tier WARM (7-30 jours)</h5><p class="text-sm text-slate-700">Donn√©es moins consult√©es (SSDs standards).</p></div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier ilm-cold"><h5 class="font-bold text-lg text-blue-800">3. Tier COLD (30-90 jours)</h5><p class="text-sm text-slate-700">Donn√©es rarement consult√©es (HDDs).</p></div>
                        <div class="text-center text-2xl text-slate-400">‚Üì</div>
                        <div class="ilm-tier border-dashed border-slate-400 bg-slate-100"><h5 class="font-bold text-lg text-slate-800">5. Delete (> 1 an)</h5><p class="text-sm text-slate-700">Suppression (RGPD).</p></div>
                    </div>
                    
                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Sauvegarde et Restauration (Snapshots)</h3>
                    <p class="text-slate-700">La HAUTE DISPONIBILIT√â (replicas) n'est PAS une SAUVEGARDE. Les Snapshots sont la vraie sauvegarde.</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 1 : Enregistrer un "D√©p√¥t" (O√π sauvegarder)</h4>
                    <p class="text-slate-700">Modifiez `elasticsearch.yml` pour d√©clarer un dossier de sauvegarde :</p>
                    <div class="code-block"><pre><code>path.repo: ["/var/backups/es"]</code></pre></div>
                    <p class="text-slate-700">(N'oubliez pas de cr√©er ce dossier `sudo mkdir /var/backups/es` et de lui donner les droits `sudo chown elasticsearch:elasticsearch /var/backups/es`). Red√©marrez ES.</p>
                    <p class="text-slate-700">Enregistrez le d√©p√¥t via Dev Tools :</p>
                    <div class="code-block">
<pre><code class="language-json">PUT /_snapshot/mon_depot_local
{
  "type": "fs",
  "settings": { "location": "/var/backups/es" }
}
</code></pre>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 2 : Cr√©er un Snapshot (La sauvegarde)</h4>
                    <div class="code-block">
<pre><code class="language-json">PUT /_snapshot/mon_depot_local/snapshot_1?wait_for_completion=true
</code></pre>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-4">√âtape 3 : Restaurer un Snapshot</h4>
                    <p class="text-slate-700">Simulons un d√©sastre (`DELETE /test-index`). Pour le restaurer :</p>
                    <div class="code-block">
<pre><code class="language-json"># D'abord, fermer l'index
POST /test-index/_close
# Lancer la restauration
POST /_snapshot/mon_depot_local/snapshot_1/_restore
{ "indices": "test-index" }
</code></pre>
                    </div>

                </section>

                <!-- 10. Quiz Final -->
                <section id="quiz" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">10. Quiz Final</h1>
                    <p class="text-lg text-slate-600">Testez vos connaissances sur les concepts fondamentaux de la stack Elastic.</p>
                    <div id="quiz-container" class="mt-8 space-y-6"></div>
                    <button id="quiz-submit" class="bg-sky-600 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:bg-sky-700 transition-colors">Valider mes r√©ponses</button>
                    
                    <div id="quiz-results" class="mt-6 hidden p-6 bg-white rounded-lg shadow-lg">
                        <div id="quiz-badge" class="text-6xl text-center"></div>
                        <h3 class="text-3xl font-semibold text-center" id="quiz-title"></h3>
                        <p class="text-2xl text-center font-semibold text-sky-700" id="quiz-score"></p>
                        <p id="quiz-feedback" class="text-lg mt-2 text-center text-slate-600"></p>
                        <div id="quiz-details" class="mt-6 space-y-2"></div>
                    </div>
                </section>

                <!-- Annexe D√©pannage VM -->
                <section id="annexe-vm" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">Annexe : D√©pannage de la VM</h1>
                    <p class="text-lg text-slate-600">Probl√®mes courants sp√©cifiques √† notre environnement VirtualBox.</p>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 1 : "VT-x is not available" au d√©marrage de la VM</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Cause :</strong> La virtualisation mat√©rielle n'est pas activ√©e dans le BIOS/UEFI de votre PC.</li>
                        <li><strong>Solution :</strong> Red√©marrez, entrez dans le BIOS (F2, F12, Suppr...), trouvez "Intel VT-x" ou "AMD-V" et "Activez" (Enable) l'option.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 2 : VM tr√®s lente</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Cause 1 :</strong> Pas assez de RAM (minimum 4096 Mo).</li>
                        <li><strong>Cause 2 (Windows) :</strong> Hyper-V est activ√© et entre en conflit.</li>
                        <li><strong>Solution (Hyper-V) :</strong> PowerShell (Admin) -> `dism.exe /Online /Disable-Feature:Microsoft-Hyper-V-All` -> Red√©marrez.</li>
                    </ul>

                    <h3 class="text-2xl font-semibold text-sky-900 mt-8">Probl√®me 3 : Impossible d'acc√©der √† Kibana/Apache depuis le navigateur h√¥te</h3>
                    <ol class="list-decimal list-inside space-y-2 text-slate-700">
                        <li><strong>Dans la VM :</strong> V√©rifiez l'IP. (`ip addr show`).</li>
                        <li><strong>Dans la VM :</strong> Le service √©coute-t-il sur `0.0.0.0` ?
                            <div class="code-block text-sm"><pre><code>sudo netstat -tlnp | grep 5601</code></pre></div>
                            <p class="text-sm">Si vous voyez `127.0.0.1:5601`, Kibana n'√©coute pas √† l'ext√©rieur. (Voir Chap 4.2 pour corriger `server.host`).</p>
                        </li>
                        <li><strong>Dans la VM :</strong> Pouvez-vous y acc√©der depuis la VM elle-m√™me ?
                            <div class="code-block text-sm"><pre><code>curl http://localhost:5601</code></pre></div>
                            <p class="text-sm">Si cela √©choue, Kibana a un probl√®me. (`sudo journalctl -u kibana -f`)</p>
                        </li>
                    </ol>
                </section>
                
                <!-- Annexe FAQ -->
                <section id="annexe-faq" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">Annexe : FAQ (Foire Aux Questions)</h1>
                    <div class="space-y-4">
                        <div>
                            <p class="faq-question">Q: Mon cluster est JAUNE. Est-ce grave ?</p>
                            <p class="text-slate-700">R: Non, en d√©veloppement, c'est normal. Cela signifie que vos shards principaux fonctionnent, mais que les r√©pliques n'ont pas pu √™tre allou√©es (car vous n'avez qu'un seul n≈ìud). C'est un risque en production, mais pas pour ce cours. (Voir Chap. 9 pour la solution).</p>
                        </div>
                         <div>
                            <p class="faq-question">Q: J'ai une erreur `_grokparsefailure` dans Logstash. Qu'est-ce que √ßa veut dire ?</p>
                            <p class="text-slate-700">R: Cela signifie que votre pattern Grok (Chap. 5) n'a pas r√©ussi √† "matcher" le log. Le log est arriv√©, mais n'a pas √©t√© pars√©. Utilisez le Grok Debugger (Kibana > Dev Tools) pour trouver l'erreur dans votre pattern.</p>
                        </div>
                        <div>
                            <p class="faq-question">Q: Quelle est la diff√©rence entre Filebeat et Logstash ?</p>
                            <p class="text-slate-700">R: Filebeat est un agent l√©ger (un "exp√©diteur") qui collecte et envoie les logs. Logstash est un processeur lourd (un "transformateur") qui re√ßoit, parse, enrichit et filtre les logs avant de les stocker. (Architecture : Filebeat -> Logstash -> Elasticsearch).</p>
                        </div>
                        <div>
                            <p class="faq-question">Q: J'ai une erreur "max virtual memory areas vm.max_map_count [...] is too low" au d√©marrage d'Elasticsearch.</p>
                            <p class="text-slate-700">R: C'est l'erreur la plus fr√©quente. Elasticsearch a besoin de plus de "memory maps" que ce que Linux autorise par d√©faut. (Voir Chap. 4.1 pour la solution : `sudo sysctl -w vm.max_map_count=262144`).</p>
                        </div>
                    </div>
                </section>

                <!-- Annexe Glossaire -->
                <section id="annexe-glossaire" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">Annexe : Glossaire</h1>
                    <div class="space-y-4">
                        <div>
                            <p class="glossary-term">Index</p>
                            <p class="text-slate-700">L'√©quivalent d'une "Table" en SQL. Une collection de documents JSON similaires.</p>
                        </div>
                        <div>
                            <p class="glossary-term">Document</p>
                            <p class="text-slate-700">L'√©quivalent d'une "Ligne" en SQL. C'est l'unit√© de base de stockage dans Elasticsearch (un objet JSON).</p>
                        </div>
                        <div>
                            <p class="glossary-term">Mapping</p>
                            <p class="text-slate-700">L'√©quivalent du "Sch√©ma" en SQL. Il d√©finit les champs et leurs types (ex: `response` est un `integer`).</p>
                        </div>
                         <div>
                            <p class="glossary-term">Shard (Fragment)</p>
                            <p class="text-slate-700">Un morceau d'un index. C'est ainsi qu'Elasticsearch distribue les donn√©es sur plusieurs serveurs.</p>
                        </div>
                         <div>
                            <p class="glossary-term">Replica (R√©plique)</p>
                            <p class="text-slate-700">Une copie d'un shard. Elle assure la haute disponibilit√© (si un n≈ìud tombe).</p>
                        </div>
                        <div>
                            <p class="glossary-term">Grok</p>
                            <p class="text-slate-700">Un filtre Logstash qui utilise des patterns pour parser du texte non structur√© (logs) en champs structur√©s (JSON).</p>
                        </div>
                         <div>
                            <p class="glossary-term">ILM (Index Lifecycle Management)</p>
                            <p class="text-slate-700">Une politique de gestion du cycle de vie des index (Hot -> Warm -> Cold -> Delete) pour g√©rer les co√ªts de stockage.</p>
                        </div>
                        <div>
                            <p class="glossary-term">Module (Beats)</p>
                            <p class="text-slate-700">Un pack de configuration pr√©-fait pour un Beat (ex: "Module Nginx") qui inclut le parsing et les dashboards Kibana.</p>
                        </div>
                        <!-- AJOUT : Analyzer -->
                        <div>
                            <p class="glossary-term">Analyzer (Analyseur)</p>
                            <p class="text-slate-700">M√©canisme interne d'ES qui d√©coupe un champ `text` en tokens (termes) pour l'indexation (ex: "Le renard" -> ["renard"]).</p>
                        </div>
                    </div>
                </section>
                
                <!-- Pour Aller Plus Loin -->
                <section id="aller-plus-loin" class="content-section space-y-6 hidden">
                    <h1 class="text-4xl font-bold tracking-tight text-slate-900">Pour Aller Plus Loin</h1>
                    <p class="text-lg text-slate-600">Le cours est termin√©, mais votre aventure ne fait que commencer.</p>
                    <div class="focus-box border-l-purple-500">
                        <h3 class="text-xl font-semibold text-purple-900 mb-4">Ressources Communautaires</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>
                                <strong>Documentation Officielle :</strong> (Votre meilleure amie)
                                <a href="https://www.elastic.co/guide/index.html" target="_blank" class="text-sky-600 underline block">elastic.co/guide</a>
                            </li>
                             <li>
                                <strong>Forum de la Communaut√© Elastic :</strong>
                                <a href="https://discuss.elastic.co/" target="_blank" class="text-sky-600 underline block">discuss.elastic.co</a>
                            </li>
                             <li>
                                <strong>Grok Debugger (Outil en ligne) :</strong> (Indispensable pour vos patterns)
                                <a href="https://grokdebug.herokuapp.com/" target="_blank" class="text-sky-600 underline block">grokdebug.herokuapp.com</a> (ou utilisez celui int√©gr√© √† Kibana)
</li>
                            <li>
                                <strong>Git pour vos Configurations :</strong>
                                <p class="text-sm">Pour le travail en √©quipe, stockez vos fichiers `/etc/logstash/conf.d/` dans un d√©p√¥t Git pour partager et versionner vos pipelines.</p>
                            </li>
                        </ul>
                    </div>

                    <!-- AJOUT : CONFIGURATION CLUSTER -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-12">Configuration d'un Cluster Elasticsearch (Avanc√©)</h3>
                    <p class="text-slate-700">Pour ce cours, nous avons utilis√© un seul n≈ìud. En production, Elasticsearch fonctionne en **cluster** pour la haute disponibilit√© (si un serveur tombe) et la scalabilit√© (r√©partir la charge).</p>
                    <p class="text-slate-700 mt-2">Voici les concepts de base pour configurer un cluster de 2 n≈ìuds (par exemple, 2 VMs s√©par√©es).</p>
                    
                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Concepts Cl√©s du Clustering</h4>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>R√¥les des N≈ìuds :</strong> Un n≈ìud peut √™tre `master` (g√®re le cluster), `data` (stocke les donn√©es), `ingest` (traite les donn√©es), etc.</li>
                        <li><strong>`cluster.name` :</strong> Tous les n≈ìuds de votre cluster DOIVENT avoir le m√™me nom.</li>
                        <li><strong>`node.name` :</strong> Chaque n≈ìud DOIT avoir un nom unique.</li>
                        <li><strong>`discovery.seed_hosts` :</strong> La liste des IPs (ou noms d'h√¥te) des n≈ìuds ma√Ætres potentiels que ce n≈ìud contactera pour rejoindre le cluster.</li>
                        <li><strong>`cluster.initial_master_nodes` :</strong> (Uniquement pour le 1er d√©marrage) La liste des `node.name` qui sont √©ligibles pour devenir le premier ma√Ætre.</li>
                    </ul>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Exemple de Configuration (`elasticsearch.yml`)</h4>
                    <p class="text-slate-700">Supposons que vous avez deux VMs : `VM-1` (IP: 192.168.1.10) et `VM-2` (IP: 192.168.1.11).</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="code-block">
<pre><code class="language-yaml"># --- VM-1 (elasticsearch.yml) ---

cluster.name: "mon_cluster_prod"
node.name: "node-1"

# √âcouter sur l'IP de la VM
network.host: 0.0.0.0

# D√©couverte
discovery.seed_hosts: ["192.168.1.10", "192.168.1.11"]
cluster.initial_master_nodes: ["node-1", "node-2"]

# R√¥les (ce n≈ìud fait tout)
node.roles: [ "master", "data", "ingest" ]
</code></pre>
                        </div>
                        <div class="code-block">
<pre><code class="language-yaml"># --- VM-2 (elasticsearch.yml) ---

cluster.name: "mon_cluster_prod"
node.name: "node-2"

# √âcouter sur l'IP de la VM
network.host: 0.0.0.0

# D√©couverte
discovery.seed_hosts: ["192.168.1.10", "192.168.1.11"]
cluster.initial_master_nodes: ["node-1", "node-2"]

# R√¥les (ce n≈ìud fait tout)
node.roles: [ "master", "data", "ingest" ]
</code></pre>
                        </div>
                    </div>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">V√©rification du Cluster</h4>
                    <p class="text-slate-700">Apr√®s avoir d√©marr√© les deux n≈ìuds, connectez-vous aux Dev Tools de Kibana (qui peut pointer vers n'importe lequel des n≈ìuds) et ex√©cutez :</p>
                    <div class="code-block">
<pre><code class="language-json">GET /_cluster/health
</code></pre>
                    </div>
                    <p class="text-slate-700">Vous devriez voir `"number_of_nodes": 2`. Si c'est le cas, votre cluster est form√© ! Votre statut passera aussi probablement au **Vert** (Green) car les r√©pliques peuvent maintenant √™tre allou√©es sur l'autre n≈ìud.</p>
                    
                    <!-- AJOUT : Firewall -->
                    <h3 class="text-2xl font-semibold text-sky-900 mt-12">Note sur le Firewall (Pare-feu) du Cluster</h3>
                    <p class="text-slate-700">Par d√©faut, le pare-feu de votre VM (`ufw`) est d√©sactiv√©. En production, il est **critique** de l'activer et de n'ouvrir que les ports n√©cessaires.</p>
                    <ul class="list-disc list-inside space-y-2 text-slate-600">
                        <li><strong>Port `9300` (TCP) :</strong> Port de "Transport". Utilis√© pour la communication **entre les n≈ìuds** du cluster. Il ne doit JAMAIS √™tre ouvert sur Internet, seulement entre vos serveurs.</li>
                        <li><strong>Port `9200` (TCP) :</strong> Port "HTTP". Utilis√© pour l'API REST. C'est ici que Kibana, Logstash, et vos applications parlent √† Elasticsearch.</li>
                        <li><strong>Port `5601` (TCP) :</strong> Port de Kibana. C'est le port que vos utilisateurs finaux acc√®dent via leur navigateur.</li>
                    </ul>

                    <h4 class="text-lg font-semibold text-slate-800 mt-6">Exemple de configuration `ufw` (sur VM-1)</h4>
                     <div class="code-block">
<pre><code class="language-bash"># Activer le pare-feu
sudo ufw enable

# Autoriser SSH (pour que vous ne soyez pas bloqu√© !)
sudo ufw allow ssh

# Autoriser Kibana pour tout le monde
sudo ufw allow 5601/tcp

# Autoriser l'API ES (9200) seulement depuis des IPs de confiance
sudo ufw allow from 192.168.1.0/24 to any port 9200

# Autoriser la communication inter-n≈ìuds (9300) SEULEMENT depuis l'autre n≈ìud
sudo ufw allow from 192.168.1.11 to any port 9300
</code></pre>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- Gestion de la Navigation (Sidebar + Sections) ---
            const sections = document.querySelectorAll('.content-section');
            const links = document.querySelectorAll('.sidebar-link');
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const menuOverlay = document.getElementById('menu-overlay');
            const mainContent = document.querySelector('main.md\\:ml-72');

            function showSection(hash) {
                sections.forEach(section => {
                    if ('#' + section.id === hash) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                links.forEach(link => {
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                const activeLink = document.querySelector(`.sidebar-link[href="${hash}"]`);
                if (activeLink) {
                    document.title = activeLink.innerText + ' - Cours Elastic';
                }

                if (window.innerWidth < 768) {
                    sidebar.classList.add('-translate-x-full');
                    menuOverlay.classList.add('opacity-0', 'hidden');
                }
            }

            links.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const hash = this.getAttribute('href');
                    if (window.location.hash !== hash) {
                        history.pushState(null, null, hash);
                    }
                    showSection(hash);
                    mainContent.scrollTo(0, 0);
                });
            });

            // Gestion du menu mobile
            menuToggle.addEventListener('click', () => {
                sidebar.classList.remove('-translate-x-full');
                menuOverlay.classList.remove('opacity-0', 'hidden');
            });
            menuOverlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                menuOverlay.classList.add('opacity-0', 'hidden');
            });

            const initialHash = window.location.hash || '#setup-vm'; 
            showSection(initialHash);

            window.addEventListener('popstate', () => {
                showSection(window.location.hash || '#setup-vm');
            });

            // --- Gestion des Blocs de Code (Copie) ---
            document.querySelectorAll('.code-block').forEach(block => {
                const pre = block.querySelector('pre');
                const codeElement = pre ? (pre.querySelector('code') || pre) : block;
                const code = codeElement.innerText;
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.innerText = 'Copier';
                
                copyBtn.addEventListener('click', () => {
                    const textarea = document.createElement('textarea');
                    textarea.value = code;
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = 0;
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        copyBtn.innerText = 'Copi√© !';
                    } catch (err) {
                        copyBtn.innerText = 'Erreur';
                    }
                    document.body.removeChild(textarea);
                    
                    setTimeout(() => {
                        copyBtn.innerText = 'Copier';
                    }, 2000);
                });
                
                block.appendChild(copyBtn);
            });

            // --- Gestion du Quiz ---
            const quizContainer = document.getElementById('quiz-container');
            const quizSubmit = document.getElementById('quiz-submit');
            const quizResults = document.getElementById('quiz-results');
            const quizScore = document.getElementById('quiz-score');
            const quizFeedback = document.getElementById('quiz-feedback');
            const quizDetails = document.getElementById('quiz-details');
            const quizBadge = document.getElementById('quiz-badge');
            const quizTitle = document.getElementById('quiz-title');

            const questions = [
                {
                    question: "Quel composant est le 'c≈ìur' de la stack, responsable du stockage et de l'indexation ?",
                    answers: { a: "Logstash", b: "Kibana", c: "Elasticsearch", d: "Filebeat" },
                    correct: "c"
                },
                {
                    question: "Quel composant est un agent l√©ger (√©crit en Go) con√ßu pour collecter des logs sur les serveurs clients ?",
                    answers: { a: "Logstash", b: "Filebeat", c: "Elasticsearch", d: "Kibana" },
                    correct: "b"
                },
                {
                    question: "Vous avez un champ 'status' (ex: 'ERROR', 'INFO'). Quel type de mapping (`text` ou `keyword`) est le plus efficace pour les filtrages et agr√©gations exacts ?",
                    answers: { a: "`text` (analyse le champ)", b: "`keyword` (garde la valeur exacte)" },
                    correct: "b"
                },
                {
                    question: "Qu'est-ce que le filtre 'Grok' dans Logstash ?",
                    answers: { a: "Un moyen de compresser les logs", b: "Un moyen de parser du texte non structur√© en champs", c: "Un moyen de crypter les donn√©es", d: "Un moyen d'envoyer des alertes" },
                    correct: "b"
                },
                {
                    question: "Votre cluster est 'Jaune' (Yellow). Qu'est-ce que cela signifie le plus probablement ?",
                    answers: { a: "Tout va bien", b: "Un shard principal est manquant, vos donn√©es sont incompl√®tes", c: "Un shard de r√©plique n'a pas pu √™tre allou√© (ex: 1 seul n≈ìud)", d: "Kibana est d√©connect√©" },
                    correct: "c"
                }
            ];

            // Afficher les questions
            if(quizContainer) {
                questions.forEach((q, i) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'p-4 bg-white rounded-lg shadow border border-slate-200';
                    
                    let answersHtml = '<div class="mt-3 space-y-2">';
                    for (const [key, value] of Object.entries(q.answers)) {
                        answersHtml += `
                            <label class="block">
                                <input type="radio" name="question${i}" value="${key}" class="mr-2">
                                ${value}
                            </label>
                        `;
                    }
                    answersHtml += '</div>';
                    
                    questionDiv.innerHTML = `
                        <p class="font-semibold text-slate-800">${i + 1}. ${q.question}</p>
                        ${answersHtml}
                    `;
                    quizContainer.appendChild(questionDiv);
                });
            }

            // Valider le quiz
            if(quizSubmit) {
                quizSubmit.addEventListener('click', () => {
                    let score = 0;
                    quizDetails.innerHTML = '';
                    
                    questions.forEach((q, i) => {
                        const selected = document.querySelector(`input[name="question${i}"]:checked`);
                        const detail = document.createElement('div');
                        detail.className = 'p-3 rounded-md';

                        if (selected) {
                            if (selected.value === q.correct) {
                                score++;
                                detail.classList.add('bg-green-100', 'border', 'border-green-300');
                                detail.innerHTML = `<span class="font-semibold text-green-700">Question ${i + 1}: Correct.</span>`;
                            } else {
                                detail.classList.add('bg-red-100', 'border', 'border-red-300');
                                detail.innerHTML = `<span class="font-semibold text-red-700">Question ${i + 1}: Incorrect.</span> La bonne r√©ponse √©tait : <strong>${q.answers[q.correct]}</strong>.`;
                            }
                        } else {
                            detail.classList.add('bg-yellow-100', 'border', 'border-yellow-300');
                            detail.innerHTML = `<span class="font-semibold text-yellow-700">Question ${i + 1}: Non r√©pondue.</span> La bonne r√©ponse √©tait : <strong>${q.answers[q.correct]}</strong>.`;
                        }
                        quizDetails.appendChild(detail);
                    });

                    quizScore.innerText = `${score} / ${questions.length}`;
                    
                    if (score === questions.length) {
                        quizBadge.innerText = 'ü•á';
                        quizTitle.innerText = 'Ma√Ætre de la Stack !';
                        quizFeedback.innerText = "Parfait ! Vous ma√Ætrisez les concepts cl√©s.";
                    } else if (score >= questions.length * 0.7) {
                        quizBadge.innerText = 'ü•à';
                        quizTitle.innerText = 'Analyste Confirm√©';
                        quizFeedback.innerText = "Bon travail ! Relisez les points que vous avez manqu√©s.";
                    } else {
                        quizBadge.innerText = 'ü•â';
                        quizTitle.innerText = 'Grok D√©butant';
                        quizFeedback.innerText = "Continuez √† r√©viser, certains concepts de base sont √† revoir.";
                    }
                    quizResults.classList.remove('hidden');
                    quizResults.scrollIntoView({ behavior: 'smooth' });
                });
            }

        });
    </script>
</body>
</html>

